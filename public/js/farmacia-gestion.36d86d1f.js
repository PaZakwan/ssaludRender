"use strict";(self["webpackChunksecretaria_de_salud_moreno_frontend"]=self["webpackChunksecretaria_de_salud_moreno_frontend"]||[]).push([[482],{3979:(a,t,e)=>{e.d(t,{Z:()=>h});var i=e(6961),r=e(683),o=e(9456),s=e(5084),n=e(4618),l=function(){var a=this,t=a._self._c;return t(o.Z,{attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},[t(r.Z,{attrs:{xs12:"","px-2":""}},[t(s.Z,{attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},scopedSlots:a._u([{key:"activator",fn:function({on:e}){return[t(n.h,a._g({attrs:{clearable:!a.soloLect&&!!a.clear,"background-color":a.soloLect?`${a.color} lighten-2`:`${a.color} lighten-5`,label:a.label,"prepend-icon":a.prepend,readonly:"",color:`${a.color} darken-3`,rules:a.req?a.validate:[]},on:{"click:clear":function(t){return a.$emit("input","")}},model:{value:a.fecha,callback:function(t){a.fecha=t},expression:"fecha"}},e))]}}]),model:{value:a.menufecha1,callback:function(t){a.menufecha1=t},expression:"menufecha1"}},[t(i.Z,{attrs:{readonly:a.soloLect,"allowed-dates":a.allowedDates,min:a.fecMin,max:a.fecMax,color:`${a.color} darken-3`,"header-color":`${a.color} darken-1`,locale:"mx"},on:{input:function(t){a.menufecha1=!1,a.$emit("input",t)}},model:{value:a.fecha,callback:function(t){a.fecha=t},expression:"fecha"}})],1)],1)],1)},d=[];const c={name:"date-select",props:["value","label","icon","color","soloLectura","requerido","min","max","filtro","clearable"],data(){return{menufecha1:!1,validate:[a=>a?""===a.trim()?"Este campo es requerido.":!(a&&a.length<10)||"Ingrese fecha valida (AAAA-MM-DD).":"Este campo es requerido."]}},computed:{fecha:function(){return this.value},soloLect:function(){return this.soloLectura||!1},prepend:function(){return this.icon||"event"},req:function(){return this.requerido||!1},clear:function(){return this.clearable||!1},fecMin:function(){return"-1"===this.min?new Date((new Date).setFullYear((new Date).getFullYear()-1)).toISOString().substring(0,10):this.min?this.min:void 0},fecMax:function(){return"+1"===this.max?new Date((new Date).setFullYear((new Date).getFullYear()+1)).toISOString().substring(0,10):this.max?this.max:void 0},restriction:function(){return this.filtro||[]}},methods:{allowedDates:function(a){return!this.restriction.includes(new Date(a).getUTCDay())}}},u=c;var m=e(1001),g=(0,m.Z)(u,l,d,!1,null,null,null);const h=g.exports},3849:(a,t,e)=>{e.d(t,{Z:()=>D});var i=e(7416),r=e(6194),o=e(8956),s=e(2353),n=e(5050),l=e(5049),d=e(683),c=e(445),u=e(3667),m=e(9456),g=e(8143),h=e(4920),p=e(4618),f=e(5730),b=function(){var a=this,t=a._self._c;return t(l.Z,{attrs:{"max-width":"80%",persistent:"",scrollable:""},model:{value:a.dialogTransferencia.state,callback:function(t){a.$set(a.dialogTransferencia,"state",t)},expression:"dialogTransferencia.state"}},[t(o.Z,[t(h.Z,{attrs:{color:"grey lighten-2",height:"auto",window:""}},[t(u.Z,{attrs:{medium:"",color:"black darken-2"}},[a._v("input")]),t("span",{staticClass:"display-1 font-weight-bold text-capitalize black--text text--darken-2"},[a._v(a._s(a.dialogTransferencia.remito?`Remito: ${a.dataEdit.remito}`:"Nueva Transferencia"))]),t(g.Cl),t(u.Z,{attrs:{large:"",disabled:a.loading.estado,color:"error darken-1"},on:{click:a.close}},[a._v("cancel_presentation")])],1),t(s.ZB,[t(c.Z,{ref:"form",attrs:{"lazy-validation":""},model:{value:a.valido,callback:function(t){a.valido=t},expression:"valido"}},[t(n.Z,{attrs:{"grid-list-md":"","pa-0":""}},[t(m.Z,{attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},[t(d.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(p.h,{attrs:{readonly:"","background-color":"primary lighten-1",value:a.mostrarFecha(a.dataEdit.fecha,"time"),"prepend-icon":"event",label:"Fecha Emision",type:"text",color:"primary"}})],1),t(d.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(p.h,{attrs:{readonly:"","background-color":"primary lighten-1","prepend-icon":"list_alt",placeholder:"El Numero de remito sera autogenerado una vez guardada la transferencia.",hint:"El Numero de remito sera autogenerado una vez guardada la transferencia.",label:"Remito",type:"text",color:"primary"},model:{value:a.dataEdit.remito,callback:function(t){a.$set(a.dataEdit,"remito",t)},expression:"dataEdit.remito"}})],1),t(d.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(i.Z,{staticClass:"capitalizar",attrs:{readonly:a.dialogTransferencia.soloLectura,clearable:!a.dialogTransferencia.soloLectura,"background-color":a.dialogTransferencia.soloLectura?"primary lighten-1":"primary lighten-5","item-value":"id","item-text":"area",items:a.areasFiltro,label:"Origen","prepend-icon":"local_shipping",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},model:{value:a.dataEdit.origen,callback:function(t){a.$set(a.dataEdit,"origen",t)},expression:"dataEdit.origen"}})],1),t(d.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(i.Z,{staticClass:"capitalizar",attrs:{readonly:a.dialogTransferencia.soloLectura,clearable:!a.dialogTransferencia.soloLectura,"background-color":a.dialogTransferencia.soloLectura?"primary lighten-1":"primary lighten-5","item-value":"id","item-text":"area",items:a.areasDestino,label:"Destino","prepend-icon":"fa-house-medical-flag",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},on:{"click:clear":function(t){a.$nextTick((()=>a.dataEdit.destino=""))}},model:{value:a.dataEdit.destino,callback:function(t){a.$set(a.dataEdit,"destino",t)},expression:"dataEdit.destino"}})],1),t(d.Z,{attrs:{"hidden-xs-only":"",sm3:"","px-3":""}}),t(d.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{soloLectura:a.dialogTransferencia.soloLectura,clearable:!a.dialogTransferencia.soloLectura,color:"primary",label:"Fecha Planificada (Opcional)",icon:"event",value:a.dataEdit.fec_planificada,min:a.hoy},model:{value:a.dataEdit.fec_planificada,callback:function(t){a.$set(a.dataEdit,"fec_planificada",t)},expression:"dataEdit.fec_planificada"}})],1),t(d.Z,{attrs:{"hidden-xs-only":"",sm3:"","px-3":""}}),t(d.Z,{attrs:{xs12:"","px-3":"",primary:"","darken-3":""}},[t("h4",{staticClass:"title float: left white--text"},[a._v("Insumos a Transferir")])]),a._l(a.dataEdit.insumos,(function(e,i){return t(d.Z,{key:`insumos-${i}`,attrs:{xs12:""}},[t("componentEgresoInsumo",{attrs:{egreso:e,index:i,stockDB:a.stockFiltrado,agregarFila:a.agregarFila,borrarFila:a.borrarFila,actualizar:a.actualizarStockFiltrado,noGestionEnOrigen:a.noGestionEnOrigen}})],1)})),t(d.Z,{attrs:{xs12:"","mx-3":""}},[t(f.Z,{attrs:{readonly:!!a.dataEdit.retirado||a.noGestionEnOrigen,clearable:!(a.dataEdit.retirado||a.noGestionEnOrigen),"background-color":a.dataEdit.retirado||a.noGestionEnOrigen?"primary lighten-1":"primary lighten-5",label:"Observacion (opcional)",color:"primary","prepend-icon":"description","auto-grow":"",rows:"2"},model:{value:a.dataEdit.observacion,callback:function(t){a.$set(a.dataEdit,"observacion",t)},expression:"dataEdit.observacion"}})],1),a.dialogTransferencia.soloLectura?t(d.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(p.h,{attrs:{readonly:"","background-color":"primary lighten-1",value:a.mostrarFecha(a.dataEdit.retirado,"time"),"prepend-icon":"local_shipping",label:"Fecha Retirado de Origen",placeholder:"Sin Retirar",type:"text",color:"primary"}})],1):a._e(),a.dialogTransferencia.soloLectura?t(d.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(p.h,{attrs:{readonly:"","background-color":"primary lighten-1",value:a.mostrarFecha(a.dataEdit.recibido,"time"),"prepend-icon":"local_shipping",label:"Fecha Recibido en Destino",placeholder:"Sin Recibir",type:"text",color:"primary"}})],1):a._e()],2)],1)],1)],1),t(s.h7,[t(m.Z,{attrs:{row:"",wrap:""}},[t(r.Z,a._g({attrs:{disabled:a.loading.estado||!!a.dataEdit.retirado||a.noGestionEnOrigen,round:"",color:"primary"},on:{click:function(t){return a.agregarFila()}}},a.on),[t(u.Z,{attrs:{left:""}},[a._v("control_point")]),a._v("Insumo Transf. ")],1),t(g.Cl),a.dataEdit._id?t(r.Z,{staticClass:"black darken-1 orange--text",attrs:{disabled:a.loading.estado||a.dialogTransferencia.soloLectura,round:"",loading:a.loading.estado},on:{click:function(t){return a.borrarTransferencia()}}},[t(u.Z,{attrs:{color:"red lighten-2",left:""}},[a._v("delete_forever")]),a._v("Borrar ")],1):a._e(),t(g.Cl),t(r.Z,{staticClass:"red darken-1 white--text",attrs:{disabled:a.loading.estado,round:"",loading:a.loading.estado},on:{click:function(t){return a.close()}}},[t(u.Z,{attrs:{left:""}},[a._v("cancel_presentation")]),a._v("Cancelar ")],1),t(r.Z,{staticClass:"primary darken-1 white--text",attrs:{disabled:a.loading.estado||!!a.dataEdit.retirado||a.noGestionEnOrigen,loading:a.loading.estado,round:""},on:{click:function(t){return a.guardarTransferencia()}}},[t(u.Z,{attrs:{left:""}},[a._v("save")]),a._v(a._s(a.valido?a.dialogTransferencia.remito?"Guardar":"Crear":"Formulario No valido")+" ")],1)],1)],1)],1)],1)},v=[],y=(e(7658),e(629)),x=e(3979),_=e(3923);const E={name:"dialogTransferencia",props:["closeFinish"],components:{dateSelect:x.Z,componentEgresoInsumo:_.Z},data:()=>({valido:!0,noGestionEnOrigen:!1,areasDB:[],areasFiltro:[],areasDestino:[],stockEntregaDB:[],stockFiltrado:[],dataEdit:{},dataEditBase:{fecha:"",remito:"",origen:"",destino:"",insumos:[{insumo:void 0,cantidad:null}],observacion:"",fec_planificada:"",retirado:"",recibido:""}}),computed:{...(0,y.rn)(["loading","hoy","persona","rules"]),...(0,y.rn)("farmacia",["dialogTransferencia"])},watch:{async"dialogTransferencia.state"(a){a?setTimeout((async()=>{this.areasDB.push(...await this.buscarAreaFiltros({filtro:{farmacia:!0},populate:"no",select:"area"})),this.areasDestino=this.areasDB,this.areasFiltro=this.persona.farmacia?.general?.admin?this.areasDB:await this.filtrarArrayParaSelectsDisabled({arraySelects:this.areasDB,arrayEnable:this.persona.farmacia?.gestion,propCompare:"_id"}),this.dialogTransferencia.remito?this.dataEdit=Object.assign(this._cloneDeep(this.dataEditBase),this._cloneDeep(this.dialogTransferencia.remito)):(this.dataEdit=this._cloneDeep(this.dataEditBase),this.dataEdit.fecha=Date.now(),this.persona.farmacia?.general?.admin||1!==this.persona.farmacia?.gestion?.length||(this.dataEdit.origen=this.persona.farmacia?.gestion[0])),this.persona.farmacia.general?.admin||!this.dataEdit.origen||this.persona.farmacia.gestion?.includes(this.dataEdit.origen)||(this.noGestionEnOrigen=!0),this.$refs.form.resetValidation()}),350):(this.dataEdit=this._cloneDeep(this.dataEditBase),this.noGestionEnOrigen=!1,this.$refs.form.resetValidation())},async"dataEdit.origen"(a,t){if(a){if(this.dataEdit.insumos.some((a=>!a.retirado))&&(this.stockEntregaDB=await this.buscarStockParaEntregas({area:a})),this.dialogTransferencia.soloLectura||this.dataEdit.destino===a&&(this.dataEdit.destino=""),t)this.dataEdit.insumos=[{...this.dataEditBase.insumos[0]}];else if(this.dialogTransferencia.remito&&this.dataEdit.insumos[0].insumo)for(let e=0;e<this.dataEdit.insumos.length;e++){let a=this.stockEntregaDB.find((a=>a._id===this.dataEdit.insumos[e].stockID));this.$set(this.dataEdit.insumos,e,{...this.dataEdit.insumos[e],insumo:a||{_id:this.dataEdit.insumos[e].stockID,insumo:this.dataEdit.insumos[e].insumo,insumoDB:this.dataEdit.insumos[e].insumoDB,procedencia:this.dataEdit.insumos[e].procedencia,lote:this.dataEdit.insumos[e].lote,vencimiento:this.dataEdit.insumos[e].vencimiento,cantidad:0}})}}else this.stockEntregaDB=[],this.dataEdit.insumos=[{...this.dataEditBase.insumos[0]}];this.areasDestino=await this.filtrarArrayParaSelectsDisabled({arraySelects:this.areasDB,arrayDisable:[a],propCompare:"_id"}),this.actualizarStockFiltrado()}},beforeMount(){this.dataEdit=this._cloneDeep(this.dataEditBase)},methods:{...(0,y.OI)(["mostrarLoading","mostrarError","mostrarMensaje","ocultarLoading"]),...(0,y.nv)(["filtrarArrayParaSelectsDisabled","requestAPI"]),...(0,y.nv)("main_areas",["buscarAreaFiltros"]),...(0,y.nv)("farmacia",["actualizarDialogIngresoTransferencia","buscarStockParaEntregas"]),close(){this.actualizarDialogIngresoTransferencia({state:!1,type:{transferencia:!0}}),this.closeFinish?.()},async actualizarStockFiltrado(){let a=[];this.dataEdit.insumos.forEach((t=>{t.insumo?._id&&a.push(t.insumo._id)})),a.length>0?this.stockFiltrado=await this.filtrarArrayParaSelectsDisabled({arraySelects:this.stockEntregaDB,arrayDisable:a,propCompare:"_id"}):this.stockFiltrado=this.stockEntregaDB},agregarFila(){this.dataEdit.insumos.push({...this.dataEditBase.insumos[0]})},borrarFila(a){this.dataEdit.insumos.splice(a,1),this.actualizarStockFiltrado()},async guardarTransferencia(){if(!this.$refs.form.validate())return this.mostrarError({mensaje:"Revise los campos obligatorios.",titulo:"Valores Requeridos."}),!1;try{this.mostrarLoading({titulo:"Efectuando cambios..."});let a=this._cloneDeep(this.dataEdit);if(!a._id){let t=this.isVacio(a,!0);if(!0===t.vacio)return this.mostrarError({mensaje:"Complete por lo menos un dato.",titulo:"Valores Requeridos"}),!1;a=t.dato}for(let e=0;e<a.insumos.length;e++)a.insumos[e].stockID=a.insumos[e].insumo._id,a.insumos[e].procedencia=a.insumos[e].insumo.procedencia,a.insumos[e].lote=a.insumos[e].insumo.lote,a.insumos[e].vencimiento=a.insumos[e].insumo.vencimiento,a.insumos[e].insumo=a.insumos[e].insumo.insumo;let t=null;if(t=await this.requestAPI({method:"put",url:"/farmacia/transferencia",update:a}),t?.data?.ok){let t=a._id?"Editada":"Guardada";return this.mostrarMensaje({msj:[`Transferencia ${t} exitosamente.`],titulo:"Completado"}),this.close(),!0}return!1}catch(a){return this.mostrarError({mensaje:a,titulo:"Inesperado (guardarTransferencia)"}),!1}finally{this.ocultarLoading()}},async borrarTransferencia(){if(await this.$root.$confirm.open({titulo:"ELIMINAR",msj:["Una vez Eliminada no se podra recuperar.",`La Transferencia: ${this.dataEdit.remito}, sera ELIMINADA.\n¿Desea continuar?`]}))try{this.mostrarLoading({titulo:"Borrando Transferencia..."});let a=null;return a=await this.requestAPI({method:"delete",url:`/farmacia/transferencia/${this.dataEdit._id}`}),!!a?.data?.ok&&(this.mostrarMensaje({msj:["Borrado exitosamente."],titulo:"Borrado Exitoso"}),this.close(),!0)}catch(a){return this.mostrarError({mensaje:a,titulo:"Inesperado (borrarTransferencia)"}),!1}finally{this.ocultarLoading()}}}},k=E;var Z=e(1001),w=(0,Z.Z)(k,b,v,!1,null,null,null);const D=w.exports},6637:(a,t,e)=>{e.r(t),e.d(t,{default:()=>P});var i=e(8469),r=e(6194),o=e(8956),s=e(2353),n=e(9418),l=e(5050),d=e(7352),c=e(108),u=e(683),m=e(3667),g=e(9456),h=e(6446),p=e(8143),f=e(4618),b=e(1415),v=function(){var a=this,t=a._self._c;return t(l.Z,{attrs:{fluid:"","grid-list-xs":""}},[t(g.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"","text-xs-center":""}},[t(u.Z,{attrs:{"pa-1":"","ma-1":"",cuarto:"",xs12:""}},[t(o.Z,{staticClass:"white--text",attrs:{color:"cuarto darken-2"}},[t(s.ZB,{staticClass:"px-0 text-uppercase"},[a._v("====== Gestion de Farmacia ======")])],1)],1)],1),t(g.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":""}},[t(u.Z,{attrs:{"pa-1":"","ma-1":"",cuarto:"",xs12:""}},[t(g.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"",cuarto:"","darken-1":""}},[t(u.Z,{attrs:{"px-3":""}},[t(m.Z,{attrs:{medium:"",color:"white",left:""}},[a._v("medication")]),t("span",{staticClass:"title white--text"},[a._v("Farmacia / Egresos")])],1),t(p.Cl),t(r.Z,{attrs:{fab:"",small:"",color:"primary darken-2"},on:{click:function(t){return a.retroceder()}}},[t(m.Z,[a._v("far fa-arrow-alt-circle-left")])],1)],1),t(o.Z,{staticClass:"elevation-6",attrs:{color:"grey lighten-2"}},[t(s.ZB,{staticClass:"px-0"},[t(g.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"","text-xs-center":""}},[t(u.Z,{attrs:{xs12:"","px-3":""}},[t(o.Z,{staticClass:"grey lighten-3"},[t(g.Z,{attrs:{"justify-center":"",row:"",wrap:""},on:{keypress:function(t){return!t.type.indexOf("key")&&a._k(t.keyCode,"enter",13,t.key,"Enter")?null:a.recargarDataTable(a.filtro)}}},[t(u.Z,{attrs:{xs12:"",sm6:"",md3:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{value:a.filtro.desde,"background-color":"cuarto lighten-5",color:"cuarto",label:"Desde",icon:"today",max:a.filtro.hasta,requerido:"true"},model:{value:a.filtro.desde,callback:function(t){a.$set(a.filtro,"desde",t)},expression:"filtro.desde"}})],1),t(u.Z,{attrs:{xs12:"",sm6:"",md3:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{value:a.filtro.hasta,"background-color":"cuarto lighten-5",color:"cuarto",label:"Hasta",icon:"event",min:a.filtro.desde,requerido:"true"},model:{value:a.filtro.hasta,callback:function(t){a.$set(a.filtro,"hasta",t)},expression:"filtro.hasta"}})],1),t(u.Z,{attrs:{xs12:"",md10:"","px-3":"","mb-3":""}},[t("componentFiltroAvanzado",{attrs:{filtro:a.filtro,areasFiltro:a.areasFiltro,insumos:{select:"nombre descripcion nombreC"},procedencia:!0}})],1)],1),t(g.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":""}},[t(r.Z,{staticClass:"white--text mb-2",attrs:{round:"",color:"cuarto darken-2",disabled:a.loading.estado,loading:a.loading.estado},on:{click:function(t){return a.recargarDataTable(a.filtro)}}},[t(m.Z,{attrs:{medium:"",left:""}},[a._v("search")]),a._v(" Buscar Egresos")],1),t(c.Z,{staticClass:"hidden-xs-only mx-4 my-1 black",attrs:{vertical:""}}),t(r.Z,{staticClass:"white--text mb-2",attrs:{round:"",color:"cuarto darken-2",disabled:a.loading.estado,loading:a.loading.estado},on:{click:function(t){return a.reporte()}}},[t(m.Z,{attrs:{medium:"",left:""}},[a._v("fa-solid fa-file-pdf")]),a._v(" Egresos PDF")],1)],1)],1)],1)],1)],1)],1)],1),t(u.Z,{attrs:{"pa-1":"","ma-1":"",xs12:"",cuarto:"","lighten-1":""}},[t(o.Z,{staticClass:"elevation-6"},[t(g.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"",primary:""}},[t(u.Z,{attrs:{"px-3":""}},[t(m.Z,{attrs:{medium:"",color:"white",left:""}},[a._v("output")]),t("span",{staticClass:"title white--text"},[a._v("Egresos de Insumos")])],1),t(p.Cl)],1),t(n.Z,[t(u.Z,{attrs:{xs12:"",sm4:"","px-2":""}},[t(f.h,{attrs:{"append-icon":"search",label:"Buscar","single-line":"","hide-details":"",clearable:""},model:{value:a.search,callback:function(t){a.search=t},expression:"search"}})],1),t(p.Cl),t(c.Z,{staticClass:"hidden-xs-only mx-2 primary",attrs:{inset:"",vertical:""}}),t(r.Z,{staticClass:"mb-2",attrs:{round:"",color:"primary",disabled:a.loading.estado||!(a.persona.farmacia.gestion?.length>0||a.persona.farmacia.general?.admin),loading:a.loading.estado},on:{click:function(t){return a.actualizarDialogDescarte({state:!0})}}},[t(m.Z,{attrs:{medium:"",left:""}},[a._v("output")]),a._v(" Nuevo Egreso")],1)],1),t(d.Z,{staticClass:"elevation-6",staticStyle:{"table-layout":"fixed"},attrs:{id:"tablita",headers:a.headers,items:a.dataTable,"item-key":"_id",pagination:a.paginacion,"rows-per-page-items":[5,10,25,50],loading:a.loading.estado,search:a.search},on:{"update:pagination":function(t){a.paginacion=t}},scopedSlots:a._u([{key:"no-results",fn:function(){return[t(i.Z,{staticClass:"text-sm-left",attrs:{value:!0,color:"error",icon:"warning"}},[a._v(' No se encontraron resultados para "'+a._s(a.search)+'". ')])]},proxy:!0},{key:"no-data",fn:function(){return[t(i.Z,{staticClass:"text-sm-left",attrs:{value:!0,color:"error",icon:"warning"}},[a._v(" No hay datos para mostrar. ")])]},proxy:!0},{key:"items",fn:function(e){return[t("tr",{class:a.backgroundClass(e.item)},[a._l(a.headersDinamics,(function(a){return t("td",{key:a.text,class:a.class},[t("bodyDataTableDinamic",{attrs:{props:e,field:a}})],1)})),t("td",{staticClass:"text-sm-left"},[t("div",{staticClass:"text-xs-center"},[t(b.Z,{attrs:{top:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:i}){return[t(r.Z,a._g({attrs:{disabled:a.loading.estado||!(a.todayInit<=e.item.retirado&&e.item.retirado<=a.todayFinish)||!(a.persona.farmacia.general?.admin||a.persona.farmacia.entregas?.includes(e.item.origen)),color:"white",small:"",icon:""},on:{click:function(t){return a.borrarDescarte({descarte:e.item})}}},i),[t(m.Z,{attrs:{color:"red"}},[a._v("delete")])],1)]}}],null,!0)},[t("span",[a._v("Borrar Entrega")])])],1)])],2)]}}])},[t(h.Z,{attrs:{color:"blue",indeterminate:""}})],1)],1)],1),t(u.Z,{attrs:{"pa-1":"","ma-1":"",red:"","darken-2":"",xs12:""}},[t(o.Z,[t(s.ZB,{staticClass:"px-3 font-weight-medium"},[t("p",[t(m.Z,{attrs:{color:"yellow darken-3",left:""}},[a._v(" warning ")]),t("b",[t("u",[a._v("Referencia de Colores:")])])],1),t("ul",[t("li",{staticClass:"green--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Verde:")])]),a._v(" Egresos con motivo de "),t("b",[t("u",[a._v("Utilizado")])]),a._v(". ")]),t("li",{staticClass:"orange--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Anaranjado:")])]),a._v(" Egresos con motivo de "),t("b",[t("u",[a._v("Vencimiento")])]),a._v(". ")]),t("li",{staticClass:"text-yellow-shadow",attrs:{type:"square"}},[t("b",[t("u",[a._v("Amarillo:")])]),a._v(" Egresos con motivo de "),t("b",[t("u",[a._v("Otros")])]),a._v(" que no sean Utilizados o por Vencimiento. ")])])])],1)],1)],1),t("dialogDescarte",{attrs:{closeFinish:a.recargarDataTable}})],1)},y=[],x=e(629),_=e(3979),E=e(5716),k=e(7416),Z=e(5049),w=e(445),D=e(4920),S=e(5730),C=function(){var a=this,t=a._self._c;return t(Z.Z,{attrs:{"max-width":"80%",persistent:"",scrollable:""},model:{value:a.dialogDescarte.state,callback:function(t){a.$set(a.dialogDescarte,"state",t)},expression:"dialogDescarte.state"}},[t(o.Z,[t(D.Z,{attrs:{color:"grey lighten-2",height:"auto",window:""}},[t(m.Z,{attrs:{medium:"",color:"black darken-2"}},[a._v("output")]),t("span",{staticClass:"display-1 font-weight-bold text-capitalize black--text text--darken-2"},[a._v(a._s(a.dialogDescarte.descarte?"Insumo Descartado":"Nuevo Egreso"))]),t(p.Cl),t(m.Z,{attrs:{large:"",disabled:a.loading.estado,color:"error darken-1"},on:{click:a.close}},[a._v("cancel_presentation")])],1),t(s.ZB,[t(w.Z,{ref:"form",attrs:{"lazy-validation":""},model:{value:a.valido,callback:function(t){a.valido=t},expression:"valido"}},[t(l.Z,{attrs:{"grid-list-md":"","pa-0":""}},[t(g.Z,{attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},[t(u.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{soloLectura:a.dialogDescarte.soloLectura,clearable:!a.dialogDescarte.soloLectura,color:"primary",label:"Fecha",icon:"event",value:a.dataEdit.fecha,max:a.hoy,requerido:"true"},model:{value:a.dataEdit.fecha,callback:function(t){a.$set(a.dataEdit,"fecha",t)},expression:"dataEdit.fecha"}})],1),t(u.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(k.Z,{staticClass:"capitalizar",attrs:{readonly:a.dialogDescarte.soloLectura,clearable:!a.dialogDescarte.soloLectura,"background-color":a.dialogDescarte.soloLectura?"primary lighten-1":"primary lighten-5","item-value":"id","item-text":"area",items:a.areasFiltro,label:"Origen","prepend-icon":"fa-house-medical-flag",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},model:{value:a.dataEdit.origen,callback:function(t){a.$set(a.dataEdit,"origen",t)},expression:"dataEdit.origen"}})],1),t(u.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(k.Z,{staticClass:"capitalizar",attrs:{readonly:a.dialogDescarte.soloLectura,clearable:!a.dialogDescarte.soloLectura,"background-color":a.dialogDescarte.soloLectura?"primary lighten-1":"primary lighten-5",items:a.descarteMotivos,label:"Motivo","prepend-icon":"description",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},model:{value:a.dataEdit.motivo,callback:function(t){a.$set(a.dataEdit,"motivo",t)},expression:"dataEdit.motivo"}})],1),"Error"===a.dataEdit.motivo?t(u.Z,{attrs:{xs12:"","mx-2":""}},[t(S.Z,{attrs:{readonly:a.dialogDescarte.soloLectura,clearable:!a.dialogDescarte.soloLectura,"background-color":a.dialogDescarte.soloLectura?"primary lighten-1":"primary lighten-5",label:"Justificacion",color:"primary","prepend-icon":"speaker_notes","auto-grow":"",rows:"2",rules:[...a.rules.requerido],"validate-on-blur":""},model:{value:a.dataEdit.justificacion,callback:function(t){a.$set(a.dataEdit,"justificacion",t)},expression:"dataEdit.justificacion"}})],1):a._e(),t(u.Z,{attrs:{xs12:"","px-3":"",primary:"","darken-3":""}},[t("h4",{staticClass:"title float: left white--text"},[a._v("Insumos a Egresar")])]),a._l(a.dataEdit.insumos,(function(e,i){return t(u.Z,{key:`insumos-${i}`,attrs:{xs12:""}},[t("componentEgresoInsumo",{attrs:{egreso:e,index:i,stockDB:a.stockFiltrado,agregarFila:a.agregarFila,borrarFila:a.borrarFila,actualizar:a.actualizarStockFiltrado,noGestionEnOrigen:!1}})],1)})),a.dialogDescarte.soloLectura?t(u.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(f.h,{attrs:{readonly:"","background-color":"primary lighten-1","prepend-icon":"local_shipping",label:"Fecha de Retirado",placeholder:"Sin Salir",type:"text",color:"primary"},model:{value:a.dataEdit.retirado,callback:function(t){a.$set(a.dataEdit,"retirado",t)},expression:"dataEdit.retirado"}})],1):a._e()],2)],1)],1)],1),t(s.h7,[t(g.Z,{attrs:{row:"",wrap:""}},[t(r.Z,a._g({attrs:{disabled:a.loading.estado||a.dialogDescarte.soloLectura,round:"",color:"primary"},on:{click:function(t){return a.agregarFila()}}},a.on),[t(m.Z,{attrs:{left:""}},[a._v("control_point")]),a._v("Insumo Egresar ")],1),t(p.Cl),t(r.Z,{staticClass:"red darken-1 white--text",attrs:{disabled:a.loading.estado,round:"",loading:a.loading.estado},on:{click:function(t){return a.close()}}},[t(m.Z,{attrs:{left:""}},[a._v("cancel_presentation")]),a._v("Cancelar ")],1),t(r.Z,{staticClass:"primary darken-1 white--text",attrs:{disabled:a.loading.estado||a.dialogDescarte.soloLectura,loading:a.loading.estado,round:""},on:{click:function(t){return a.guardarDescarte()}}},[t(m.Z,{attrs:{left:""}},[a._v("save")]),a._v(a._s(a.valido?a.dialogDescarte.descarte?"Guardar":"Realizar Egreso":"Formulario No valido")+" ")],1)],1)],1)],1)],1)},F=[],T=(e(7658),e(3923));const I={name:"dialogDescarte",props:["closeFinish"],components:{dateSelect:_.Z,componentEgresoInsumo:T.Z},data:()=>({valido:!0,areasFiltro:[],stockEntregaDB:[],stockFiltrado:[],dataEdit:{},dataEditBase:{fecha:"",origen:"",motivo:"",justificacion:"",insumos:[{insumo:void 0,cantidad:null}],retirado:""},descarteMotivos:["Utilizado","Vencimiento","Rotura","Mal estado","Robo","Hurto","Devolucion","Error"]}),computed:{...(0,x.rn)(["loading","hoy","persona","rules"]),...(0,x.rn)("farmacia",["dialogDescarte"])},watch:{async"dialogDescarte.state"(a){a?setTimeout((async()=>{let a=[...await this.buscarAreaFiltros({filtro:{farmacia:!0},populate:"no",select:"area"})];this.areasFiltro=this.persona.farmacia?.general?.admin?a:await this.filtrarArrayParaSelectsDisabled({arraySelects:a,arrayEnable:this.persona.farmacia?.gestion,propCompare:"_id"}),this.dataEdit=this._cloneDeep(this.dataEditBase),this.persona.farmacia?.general?.admin||1!==this.persona.farmacia?.gestion?.length||(this.dataEdit.origen=this.persona.farmacia?.gestion[0]),this.$refs.form.resetValidation()}),350):(this.dataEdit=this._cloneDeep(this.dataEditBase),this.$refs.form.resetValidation())},async"dataEdit.origen"(a){this.stockEntregaDB=a?await this.buscarStockParaEntregas({area:a}):[],this.dataEdit.insumos=[{...this.dataEditBase.insumos[0]}],this.actualizarStockFiltrado()},"dataEdit.motivo"(a){"Error"!==a&&(this.dataEdit.justificacion="")}},beforeMount(){this.dataEditBase.fecha=this.hoy,this.dataEdit=this._cloneDeep(this.dataEditBase)},methods:{...(0,x.OI)(["mostrarLoading","mostrarError","mostrarMensaje","ocultarLoading"]),...(0,x.nv)(["filtrarArrayParaSelectsDisabled","requestAPI"]),...(0,x.nv)("main_areas",["buscarAreaFiltros"]),...(0,x.nv)("farmacia",["actualizarDialogDescarte","buscarStockParaEntregas"]),close(){this.actualizarDialogDescarte({state:!1}),this.closeFinish?.()},async actualizarStockFiltrado(){let a=[];this.dataEdit.insumos.forEach((t=>{t.insumo?._id&&a.push(t.insumo._id)})),a.length>0?this.stockFiltrado=await this.filtrarArrayParaSelectsDisabled({arraySelects:this.stockEntregaDB,arrayDisable:a,propCompare:"_id"}):this.stockFiltrado=this.stockEntregaDB},agregarFila(){this.dataEdit.insumos.push({...this.dataEditBase.insumos[0]})},borrarFila(a){this.dataEdit.insumos.splice(a,1),this.actualizarStockFiltrado()},async guardarDescarte(){if(!this.$refs.form.validate())return this.mostrarError({mensaje:"Revise los campos obligatorios.",titulo:"Valores Requeridos."}),!1;try{this.mostrarLoading({titulo:"Efectuando cambios..."});let a=this._cloneDeep(this.dataEdit);if(!a._id){let t=this.isVacio(a,!0);if(!0===t.vacio)return this.mostrarError({mensaje:"Complete por lo menos un dato.",titulo:"Valores Requeridos"}),!1;a=t.dato}let t=null;if(t=await this.requestAPI({method:"put",url:"/farmacia/descarte",update:a}),t?.data?.ok){let t=a._id?"Editado":"Guardado";return this.mostrarMensaje({msj:[`Descarte ${t} exitosamente.`],titulo:"Completado"}),this.close(),!0}return!1}catch(a){return this.mostrarError({mensaje:a,titulo:"Inesperado (guardarDescarte)"}),!1}finally{this.ocultarLoading()}}}},A=I;var B=e(1001),L=(0,B.Z)(A,C,F,!1,null,null,null);const $=L.exports;var R=e(3718);const z={name:"farmaciaDescarteBuscar",components:{dateSelect:_.Z,bodyDataTableDinamic:E.Z,dialogDescarte:$,componentFiltroAvanzado:R.Z},data:()=>({areasFiltro:[],dataTable:[],filtro:{desde:"",hasta:"",areas:[],insumos:[],procedencias:[]},ultimoFiltro:{},search:"",paginacion:{sortBy:"fecha",descending:!0,rowsPerPage:10,page:1},headers:[{text:"Fecha",value:"fecha",align:"left",class:"text-xs-left",width:"10%",ruta:"fecha",date:!0},{text:"Origen",value:"origenDB",align:"left",class:"text-capitalize text-xs-left",width:"15%",ruta:"origenDB"},{text:"Categoria Ins.",value:"categoriaDB",align:"left",class:"text-xs-left",width:"10%",ruta:"categoriaDB"},{text:"Insumo",value:"insumoDB",align:"left",class:"text-capitalize text-xs-left",width:"10%",ruta:"insumoDB"},{text:"Cantidad",value:"cantidad",align:"left",class:"text-xs-right",width:"10%",ruta:"cantidad"},{text:"Motivo",value:"motivo",align:"left",class:"text-capitalize text-xs-left",ruta:"motivo"},{text:"Justificacion",value:"justificacion",align:"left",class:"text-xs-left",ruta:"justificacion"},{text:"Procedencia",value:"procedencia",align:"left",class:"text-xs-left",width:"10%",ruta:"procedencia"},{text:"Lote",value:"lote",align:"left",class:"text-xs-right",width:"10%",ruta:"lote"},{text:"Vencimiento",value:"vencimiento",align:"left",class:"text-xs-left",width:"10%",ruta:"vencimiento",date:!0},{text:"Fecha de Carga",value:"retirado",align:"left",class:"text-xs-left",width:"10%",ruta:"retirado",date:!0,time:!0},{text:"Acciones",value:"id",align:"center",sortable:!1,width:"5%",ruta:"id",ignore:!0}]}),computed:{...(0,x.rn)(["loading","todayInit","todayFinish","hoy","monthBefore","persona"]),headersDinamics(){return[...this.headers.filter((a=>!0!==a.ignore))]}},async created(){this.filtro.desde=this.monthBefore,this.filtro.hasta=this.hoy;let a=[...await this.buscarAreaFiltros({filtro:{farmacia:!0},populate:"no",select:"area"})];this.persona.farmacia.general?.reportes||this.persona.farmacia.general?.admin?(this.areasFiltro=a,this.filtro.areas=a.map((a=>a.id))):(this.areasFiltro=await this.filtrarArrayParaSelectsDisabled({arraySelects:a,arrayEnable:this.persona.farmacia.gestion,propCompare:"_id"}),this.filtro.areas=[...this.persona.farmacia.gestion]),await this.recargarDataTable(this.filtro)},methods:{...(0,x.OI)(["mostrarLoading","mostrarMensaje","mostrarError","ocultarLoading","mostrarDialogIframe"]),...(0,x.nv)(["retroceder","routerResolve","filtrarArrayParaSelectsDisabled","requestAPI"]),...(0,x.nv)("main_areas",["buscarAreaFiltros"]),...(0,x.nv)("farmacia",["actualizarDialogDescarte","getRequestFilter"]),backgroundClass(a){if(!a)return"";try{return"Utilizado"===a.motivo?"background-color: green lighten-5":"Vencimiento"===a.motivo?"background-color: orange lighten-4":"background-color: yellow lighten-4"}catch(t){return""}},async recargarDataTable(a){if(a){let t=await this.buscarDescartesFiltro(a);t&&(this.dataTable=t,this.ultimoFiltro=this._cloneDeep(a))}else this.dataTable=await this.buscarDescartesFiltro(this.ultimoFiltro);this.paginacion.page>Math.ceil(this.dataTable?.length/this.paginacion.rowsPerPage)&&(this.paginacion.page=1)},async buscarDescartesFiltro(a){try{this.mostrarLoading({titulo:"Buscando Descartes..."});let t=await this.getRequestFilter({payload:a});if(t.error)return;let e=null;return e=await this.requestAPI({method:"get",url:`/farmacia/descarte?${t.dato}`}),e?.data?.ok?e.data.descartes:[{origenDB:"error de carga, recargar pagina",id:void 0}]}catch(t){return this.mostrarError({mensaje:t,titulo:"Inesperado (buscarDescartesFiltro)"}),[{origenDB:"error de carga(buscarDescartesFiltro), recargar pagina",id:void 0}]}finally{this.ocultarLoading()}},async reporte(){if(this.filtro.areas.length>0){localStorage.setItem("pdfTemp",JSON.stringify(this.filtro));let a=await this.routerResolve({name:"FarmaciaDescarteImprimir",query:{descarga:!1}});this.mostrarDialogIframe({src:a.href,titulo_name:`Farmacia Egresos ${this.filtro.desde} ~ ${this.filtro.hasta}`})}else this.mostrarError({errores:"",mensaje:"Complete por lo menos con una Farmacia para el reporte.",titulo:"Valores Requeridos."})},async borrarDescarte(a){if(await this.$root.$confirm.open({titulo:"ELIMINAR",msj:["Se Recuperará el Stock descartado.",`El Descarte de ${a.descarte.insumoDB} (${a.descarte.cantidad}) con motivo ${a.descarte.motivo}, sera Eliminado.\n¿Desea continuar??`]}))try{this.mostrarLoading({titulo:"Borrando Descarte..."});let t=null;return t=await this.requestAPI({method:"delete",url:`/farmacia/descarte/${a.descarte._id}`}),!!t?.data?.ok&&(this.mostrarMensaje({msj:["Borrado exitosamente."],titulo:"Borrado Exitoso"}),this.recargarDataTable(),!0)}catch(t){return this.mostrarError({mensaje:t,titulo:"Inesperado (borrarDescarte)"}),!1}finally{this.ocultarLoading()}}}},q=z;var j=(0,B.Z)(q,v,y,!1,null,null,null);const P=j.exports},6028:(a,t,e)=>{e.r(t),e.d(t,{default:()=>O});var i=e(8469),r=e(7416),o=e(6194),s=e(8956),n=e(2353),l=e(9418),d=e(5050),c=e(7352),u=e(108),m=e(683),g=e(3667),h=e(9456),p=e(6446),f=e(8143),b=e(4618),v=e(1415),y=function(){var a=this,t=a._self._c;return t(d.Z,{attrs:{fluid:"","grid-list-xs":""}},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"","text-xs-center":""}},[t(m.Z,{attrs:{"pa-1":"","ma-1":"",cuarto:"",xs12:""}},[t(s.Z,{staticClass:"white--text",attrs:{color:"cuarto darken-2"}},[t(n.ZB,{staticClass:"px-0 text-uppercase"},[a._v("====== Gestion de Farmacia ======")])],1)],1)],1),t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":""}},[t(m.Z,{attrs:{"pa-1":"","ma-1":"",cuarto:"",xs12:""}},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"",cuarto:"","darken-1":""}},[t(m.Z,{attrs:{"px-3":""}},[t(g.Z,{attrs:{medium:"",color:"white",left:""}},[a._v("medication")]),t("span",{staticClass:"title white--text"},[a._v("Farmacia / Ingresos")])],1),t(f.Cl),t(o.Z,{attrs:{fab:"",small:"",color:"primary darken-2"},on:{click:function(t){return a.retroceder()}}},[t(g.Z,[a._v("far fa-arrow-alt-circle-left")])],1)],1),t(s.Z,{staticClass:"elevation-6",attrs:{color:"grey lighten-2"}},[t(n.ZB,{staticClass:"px-0"},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"","text-xs-center":""}},[t(m.Z,{attrs:{xs12:"","px-3":""}},[t(s.Z,{staticClass:"grey lighten-3"},[t(h.Z,{attrs:{"justify-center":"",row:"",wrap:""},on:{keypress:function(t){return!t.type.indexOf("key")&&a._k(t.keyCode,"enter",13,t.key,"Enter")?null:a.recargarDataTable(a.filtro)}}},[t(m.Z,{attrs:{xs12:"",sm6:"",md3:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{value:a.filtro.desde,"background-color":"cuarto lighten-5",color:"cuarto",label:"Desde",icon:"today",max:a.filtro.hasta,requerido:"true"},model:{value:a.filtro.desde,callback:function(t){a.$set(a.filtro,"desde",t)},expression:"filtro.desde"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"",md3:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{value:a.filtro.hasta,"background-color":"cuarto lighten-5",color:"cuarto",label:"Hasta",icon:"event",min:a.filtro.desde,requerido:"true"},model:{value:a.filtro.hasta,callback:function(t){a.$set(a.filtro,"hasta",t)},expression:"filtro.hasta"}})],1),t(m.Z,{attrs:{xs12:"",md10:"","px-3":"","mb-3":""}},[t("componentFiltroAvanzado",{attrs:{filtro:a.filtro,areasFiltro:a.areasFiltro,insumos:{select:"nombre descripcion nombreC"},procedencia:!0}})],1)],1),t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":""}},[t(o.Z,{staticClass:"white--text mb-2",attrs:{round:"",color:"cuarto darken-2",disabled:a.loading.estado,loading:a.loading.estado},on:{click:function(t){return a.recargarDataTable(a.filtro)}}},[t(g.Z,{attrs:{medium:"",left:""}},[a._v("search")]),a._v(" Buscar Ingresos")],1),t(u.Z,{staticClass:"hidden-xs-only mx-4 my-1 black",attrs:{vertical:""}}),t(o.Z,{staticClass:"white--text mb-2",attrs:{round:"",color:"cuarto darken-2",disabled:a.loading.estado,loading:a.loading.estado},on:{click:function(t){return a.reporte()}}},[t(g.Z,{attrs:{medium:"",left:""}},[a._v("fa-solid fa-file-pdf")]),a._v(" Insumos Recibidos PDF")],1)],1)],1)],1)],1)],1)],1)],1),t(m.Z,{attrs:{"pa-1":"","ma-1":"",xs12:"",cuarto:"","lighten-1":""}},[t(s.Z,{staticClass:"elevation-6"},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"",primary:""}},[t(m.Z,{attrs:{"px-3":""}},[t(g.Z,{attrs:{medium:"",color:"white",left:""}},[a._v("list_alt")]),t("span",{staticClass:"title white--text"},[a._v("Ingresos de Insumos")])],1)],1),t(l.Z,[t(m.Z,{attrs:{xs12:"",sm4:"","px-2":""}},[t(b.h,{attrs:{"append-icon":"search",label:"Buscar","single-line":"","hide-details":"",clearable:""},model:{value:a.search,callback:function(t){a.search=t},expression:"search"}})],1),t(f.Cl),t(m.Z,{attrs:{xs12:"",sm6:"",md4:"","px-2":""}},[t(r.Z,{attrs:{items:a.dataTableSelect,label:"Mostrar","prepend-icon":"list_alt",color:"cuarto","background-color":"cuarto lighten-5"},model:{value:a.dataTableSelected,callback:function(t){a.dataTableSelected=t},expression:"dataTableSelected"}})],1),t(u.Z,{staticClass:"hidden-xs-only mx-2 primary",attrs:{inset:"",vertical:""}}),t(o.Z,{staticClass:"mb-2",attrs:{round:"",color:"primary",disabled:a.loading.estado||!(a.persona.farmacia.gestion?.length>0||a.persona.farmacia.general?.admin),loading:a.loading.estado},on:{click:function(t){return a.actualizarDialogIngresoTransferencia({state:!0,type:{ingreso:!0}})}}},[t(g.Z,{attrs:{medium:"",left:""}},[a._v("input")]),a._v(" Nuevo Ingreso")],1)],1),t(c.Z,{staticClass:"elevation-6",staticStyle:{"table-layout":"fixed"},attrs:{id:"tablita",headers:a.headers,items:a.dataTableFilter,"item-key":"_id",pagination:a.paginacion,"rows-per-page-items":[5,10,25,50],loading:a.loading.estado,search:a.search,"custom-filter":a.customFilter},on:{"update:pagination":function(t){a.paginacion=t}},scopedSlots:a._u([{key:"no-results",fn:function(){return[t(i.Z,{staticClass:"text-sm-left",attrs:{value:!0,color:"error",icon:"warning"}},[a._v(' No se encontraron resultados para "'+a._s(a.search)+'". ')])]},proxy:!0},{key:"no-data",fn:function(){return[t(i.Z,{staticClass:"text-sm-left",attrs:{value:!0,color:"error",icon:"warning"}},[a._v(" No hay datos para mostrar. ")])]},proxy:!0},{key:"items",fn:function(e){return[t("tr",{class:a.backgroundClass(e.item)},[t("td",{staticClass:"text-sm-left"},[t("div",{staticClass:"text-xs-center",staticStyle:{width:"90px"}},[t(v.Z,{attrs:{top:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:i}){return[t(o.Z,a._g({attrs:{disabled:a.noAdminNoGestion||a.loading.estado||e.item.recibido||e.item.remito&&!e.item.retirado||a.noAdminSiGestion&&!a.persona.farmacia.gestion.includes(e.item.destino),color:"white",small:"",icon:""},on:{click:function(t){return a.recibirIngreso({ingreso:{id:e.item._id,remito_compra:e.item.remito_compra,remito:e.item.remito},finish:a.recargarDataTable,confirm:a.$root.$confirm})}}},i),[t(g.Z,{attrs:{color:e.item.recibido?"green":"red"}},[a._v(a._s(e.item.recibido?"task_alt":"radio_button_unchecked"))])],1)]}}],null,!0)},[t("span",[a._v("Recibir")])]),t(v.Z,{attrs:{right:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:i}){return[t(o.Z,a._g({attrs:{disabled:a.loading.estado,color:"white",small:"",icon:""},on:{click:function(t){return a.actualizarDialogIngresoTransferencia({state:!0,type:{ingreso:!!e.item.remito_compra,transferencia:!!e.item.remito},ingreso:{remito_compra:e.item.remito_compra?e.item:null,remito:e.item.remito?e.item:null}})}}},i),[t(g.Z,{attrs:{color:"primary"}},[a._v("visibility")])],1)]}}],null,!0)},[t("span",[a._v(a._s(e.item.remito?"Ver Transferencia":"Ver Ingreso"))])])],1)]),a._l(a.headersDinamics,(function(a){return t("td",{key:a.text,class:a.class},[t("bodyDataTableDinamic",{attrs:{props:e,field:a}})],1)}))],2)]}}])},[t(p.Z,{attrs:{color:"blue",indeterminate:""}})],1)],1)],1),t(m.Z,{attrs:{"pa-1":"","ma-1":"",red:"","darken-2":"",xs12:""}},[t(s.Z,[t(n.ZB,{staticClass:"px-3 font-weight-medium"},[t("p",[t(g.Z,{attrs:{color:"yellow darken-3",left:""}},[a._v(" warning ")]),t("b",[t("u",[a._v("Referencia de Colores:")])])],1),t("ul",[t("li",{staticClass:"green--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Verde:")])]),a._v(" Transicion "),t("b",[t("u",[a._v("Finalizada")])]),a._v(" (Recibida). ")]),t("li",{staticClass:"orange--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Anaranjado:")])]),a._v(" Transicion incompleta falta que la "),t("b",[t("u",[a._v("Recibamos")])]),a._v(" en Destino. ")]),t("li",{staticClass:"text-yellow-shadow",attrs:{type:"square"}},[t("b",[t("u",[a._v("Amarillo:")])]),a._v(" Transicion incompleta falta que la "),t("b",[t("u",[a._v("Retiremos")])]),a._v(" del Origen (Desde Transferencias). ")]),t("li",{staticClass:"grey--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Gris:")])]),t("ul",[t("li",[a._v(" Transicion incompleta falta que la "),t("b",[t("u",[a._v("Reciban")])]),a._v(" en Destino. ")]),t("li",[a._v(" Transicion incompleta falta que la "),t("b",[t("u",[a._v("Retiren")])]),a._v(" del Origen. ")])])])])])],1)],1)],1),t("dialogIngreso",{attrs:{closeFinish:a.recargarDataTable}}),t("dialogTransferencia",{attrs:{closeFinish:a.recargarDataTable}})],1)},x=[],_=e(629),E=e(3979),k=e(5716),Z=e(7441),w=e(5049),D=e(445),S=e(4920),C=e(5730),F=function(){var a=this,t=a._self._c;return t(w.Z,{attrs:{"max-width":"80%",persistent:"",scrollable:""},model:{value:a.dialogIngreso.state,callback:function(t){a.$set(a.dialogIngreso,"state",t)},expression:"dialogIngreso.state"}},[t(s.Z,[t(S.Z,{attrs:{color:"grey lighten-2",height:"auto",window:""}},[t(g.Z,{attrs:{medium:"",color:"black darken-2"}},[a._v("input")]),t("span",{staticClass:"display-1 font-weight-bold text-capitalize black--text text--darken-2"},[a._v(a._s(a.dialogIngreso.remito_compra?`Editar: ${a.dataEdit.remito_compra}`:"Nuevo Ingreso"))]),t(f.Cl),t(g.Z,{attrs:{large:"",disabled:a.loading.estado,color:"error darken-1"},on:{click:a.close}},[a._v("cancel_presentation")])],1),t(n.ZB,[t(D.Z,{ref:"form",attrs:{"lazy-validation":""},model:{value:a.valido,callback:function(t){a.valido=t},expression:"valido"}},[t(d.Z,{attrs:{"grid-list-md":"","pa-0":""}},[a.dialogIngreso.soloLectura?a._e():t(h.Z,{attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},[t("div",{staticClass:"text-xs-center"},[t(Z.Z,{staticClass:"mt-2",attrs:{"false-value":!1,"true-value":!0,color:"primary lighten-1"},scopedSlots:a._u([{key:"label",fn:function(){return[t(g.Z,{attrs:{left:""}},[a._v("inventory_2")]),a._v(" Carga Inicial: "+a._s(a.cargaInicial?"Si":"No")+" ")]},proxy:!0}],null,!1,293394657),model:{value:a.cargaInicial,callback:function(t){a.cargaInicial=t},expression:"cargaInicial"}})],1)]),t(h.Z,{attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},[t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(b.h,{attrs:{readonly:"","background-color":"primary lighten-1",value:a.mostrarFecha(a.dataEdit.fecha,"time"),"prepend-icon":"event",label:"Fecha",type:"text",color:"primary"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(b.h,{attrs:{readonly:a.dialogIngreso.soloLectura||"Carga inicial"===a.dataEdit.remito_compra,clearable:!(a.dialogIngreso.soloLectura||"Carga inicial"===a.dataEdit.remito_compra),"background-color":a.dialogIngreso.soloLectura||"Carga inicial"===a.dataEdit.remito_compra?"primary lighten-1":"primary lighten-5","prepend-icon":"list_alt",label:"Remito de Compra",placeholder:"YYYY-NumeroDeOrden",type:"text",color:"primary",rules:[...a.rules.requerido,a.rules.minLength(6)]},model:{value:a.dataEdit.remito_compra,callback:function(t){a.$set(a.dataEdit,"remito_compra",t)},expression:"dataEdit.remito_compra"}})],1),a.dialogIngreso.soloLectura?t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(b.h,{attrs:{readonly:"","background-color":"primary lighten-1",label:"Procedencia / Proveedor","prepend-icon":"local_shipping",type:"text",color:"primary"},model:{value:a.dataEdit.proveedor,callback:function(t){a.$set(a.dataEdit,"proveedor",t)},expression:"dataEdit.proveedor"}})],1):t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(r.Z,{attrs:{readonly:"Carga inicial"===a.dataEdit.proveedor,clearable:!("Carga inicial"===a.dataEdit.proveedor),"background-color":"Carga inicial"===a.dataEdit.proveedor?"primary lighten-1":"primary lighten-5",items:a.farmaciaProveedores,label:"Procedencia / Proveedor","prepend-icon":"local_shipping",color:"primary",rules:[...a.rules.requerido]},model:{value:a.dataEdit.proveedor,callback:function(t){a.$set(a.dataEdit,"proveedor",t)},expression:"dataEdit.proveedor"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(r.Z,{attrs:{readonly:a.dialogIngreso.soloLectura,clearable:!a.dialogIngreso.soloLectura,"background-color":a.dialogIngreso.soloLectura?"primary lighten-1":"primary lighten-5","item-value":"id","item-text":"area",items:a.areasFiltro,label:"Destino","prepend-icon":"fa-house-medical-flag",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},model:{value:a.dataEdit.destino,callback:function(t){a.$set(a.dataEdit,"destino",t)},expression:"dataEdit.destino"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(b.h,{attrs:{readonly:a.dialogIngreso.soloLectura||"Carga inicial"===a.dataEdit.orden_compra,clearable:!(a.dialogIngreso.soloLectura||"Carga inicial"===a.dataEdit.orden_compra),"background-color":a.dialogIngreso.soloLectura||"Carga inicial"===a.dataEdit.orden_compra?"primary lighten-1":"primary lighten-5","prepend-icon":"list_alt",label:"Orden de Compra (Opcional)",type:"text",color:"primary"},model:{value:a.dataEdit.orden_compra,callback:function(t){a.$set(a.dataEdit,"orden_compra",t)},expression:"dataEdit.orden_compra"}})],1),t(m.Z,{attrs:{xs12:"","px-3":"",primary:"","darken-3":""}},[t("h4",{staticClass:"title float: left white--text"},[a._v("Insumos a Ingresar")])]),a._l(a.dataEdit.insumos,(function(e,i){return t(m.Z,{key:`insumos-${i}`,attrs:{xs12:""}},[t(h.Z,{class:"grey lighten-"+(i%2===0?"3":"2"),attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},[t(m.Z,{attrs:{xs12:"",md8:"",lg9:"","px-3":""}},[t(r.Z,{attrs:{readonly:a.dataEdit.insumos[i].recibido,clearable:!a.dataEdit.insumos[i].recibido,"background-color":a.dataEdit.insumos[i].recibido?"primary lighten-1":"primary lighten-5","item-value":"id","item-text":"nombreC",items:a.insumosDB,label:"Insumo","prepend-icon":"fa-solid fa-pills",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},on:{"click:clear":function(t){a.$nextTick((()=>a.dataEdit.insumos[i].insumo=""))}},model:{value:a.dataEdit.insumos[i].insumo,callback:function(t){a.$set(a.dataEdit.insumos[i],"insumo",t)},expression:"dataEdit.insumos[index].insumo"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"",md4:"",lg3:"","px-3":""}},[t(b.h,{attrs:{readonly:"","background-color":"primary lighten-1",label:"Procedencia","prepend-icon":"trip_origin",type:"text",color:"primary"},model:{value:a.dataEdit.insumos[i].procedencia,callback:function(t){a.$set(a.dataEdit.insumos[i],"procedencia",t)},expression:"dataEdit.insumos[index].procedencia"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"",lg3:"","px-3":""}},[t(b.h,{attrs:{readonly:a.dataEdit.insumos[i].recibido,clearable:!a.dataEdit.insumos[i].recibido,"background-color":a.dataEdit.insumos[i].recibido?"primary lighten-1":"primary lighten-5","prepend-icon":"group_work",label:"Lote",type:"text",color:"primary"},model:{value:a.dataEdit.insumos[i].lote,callback:function(t){a.$set(a.dataEdit.insumos[i],"lote",t)},expression:"dataEdit.insumos[index].lote"}})],1),t(m.Z,{attrs:{xs12:"",sm5:"",md6:"",lg4:"","px-3":""}},[t("dateSelect",{attrs:{value:a.dataEdit.insumos[i].vencimiento,soloLectura:a.dataEdit.insumos[i].recibido,clearable:!a.dataEdit.insumos[i].recibido,color:"primary",label:"Vencimiento",icon:"event",requerido:!1},model:{value:a.dataEdit.insumos[i].vencimiento,callback:function(t){a.$set(a.dataEdit.insumos[i],"vencimiento",t)},expression:"dataEdit.insumos[index].vencimiento"}})],1),t(m.Z,{attrs:{xs12:"",sm5:"",md6:"",lg3:"","px-3":""}},[t(b.h,{attrs:{readonly:a.dataEdit.insumos[i].recibido,clearable:!a.dataEdit.insumos[i].recibido,"background-color":a.dataEdit.insumos[i].recibido?"primary lighten-1":"primary lighten-5","prepend-icon":"grain",label:"Cantidad",type:"number",onkeydown:"return event.key !== 'e' && event.key !== 'E' && event.key !== '.' && event.key !== ',' && event.key !== '+' && event.key !== '-'",color:"primary",rules:[...a.rules.requerido,...a.rules.soloNumero,a.rules.minNumber(1)],"validate-on-blur":""},model:{value:a.dataEdit.insumos[i].cantidad,callback:function(t){a.$set(a.dataEdit.insumos[i],"cantidad",t)},expression:"dataEdit.insumos[index].cantidad"}})],1),t(f.Cl),0==i?t(v.Z,{attrs:{top:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:e}){return[t(o.Z,a._g({attrs:{disabled:a.loading.estado||!!a.dataEdit.recibido,fab:"",small:"",color:"primary"},on:{click:function(t){return a.agregarFila(a.dataEdit.insumos,{...a.dataEditBase.insumos[0],procedencia:a.dataEdit.insumos[0].procedencia})}}},e),[t(g.Z,{attrs:{"x-large":""}},[a._v("control_point")])],1)]}}],null,!0)},[t("span",[a._v("Agregar Insumo Ingreso")])]):a._e(),0!=i?t(v.Z,{attrs:{top:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:e}){return[t(o.Z,a._g({attrs:{disabled:a.loading.estado||a.dataEdit.insumos[i].recibido,small:"",icon:"",color:"white"},on:{click:function(t){return a.borrarFila(a.dataEdit.insumos,i)}}},e),[t(g.Z,{attrs:{color:"red lighten-2"}},[a._v("delete_forever")])],1)]}}],null,!0)},[t("span",[a._v("Eliminar Insumo")])]):a._e(),t(f.Cl,{staticClass:"hidden-xs-only"})],1)],1)})),t(m.Z,{attrs:{xs12:"","mx-3":""}},[t(C.Z,{attrs:{readonly:a.dialogIngreso.soloLectura,clearable:!a.dialogIngreso.soloLectura,"background-color":a.dialogIngreso.soloLectura?"primary lighten-1":"primary lighten-5",label:"Observacion (opcional)",color:"primary","prepend-icon":"description","auto-grow":"",rows:"2"},model:{value:a.dataEdit.observacion,callback:function(t){a.$set(a.dataEdit,"observacion",t)},expression:"dataEdit.observacion"}})],1),a.dialogIngreso.soloLectura?t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(b.h,{attrs:{readonly:"","background-color":"primary lighten-1",value:a.mostrarFecha(a.dataEdit.recibido,"time"),"prepend-icon":"local_shipping",label:"Fecha Recibido en Destino",placeholder:"Sin Recibir",type:"text",color:"primary"}})],1):a._e()],2)],1)],1)],1),t(n.h7,[t(h.Z,{attrs:{row:"",wrap:""}},[t(o.Z,a._g({attrs:{disabled:a.loading.estado||!!a.dataEdit.recibido,round:"",color:"primary"},on:{click:function(t){return a.agregarFila(a.dataEdit.insumos,{...a.dataEditBase.insumos[0],procedencia:a.dataEdit.insumos[0].procedencia})}}},a.on),[t(g.Z,{attrs:{left:""}},[a._v("control_point")]),a._v("Insumo Ingreso ")],1),t(f.Cl),a.dataEdit._id?t(o.Z,{staticClass:"black darken-1 orange--text",attrs:{disabled:a.loading.estado||a.dialogIngreso.soloLectura,round:"",loading:a.loading.estado},on:{click:function(t){return a.borrarIngreso()}}},[t(g.Z,{attrs:{color:"red lighten-2",left:""}},[a._v("delete_forever")]),a._v("Borrar ")],1):a._e(),t(f.Cl),t(o.Z,{staticClass:"red darken-1 white--text",attrs:{disabled:a.loading.estado,round:"",loading:a.loading.estado},on:{click:function(t){return a.close()}}},[t(g.Z,{attrs:{left:""}},[a._v("cancel_presentation")]),a._v("Cancelar ")],1),t(o.Z,{staticClass:"primary darken-1 white--text",attrs:{disabled:a.loading.estado||!!a.dataEdit.recibido,loading:a.loading.estado,round:""},on:{click:function(t){return a.guardarIngreso()}}},[t(g.Z,{attrs:{left:""}},[a._v("save")]),a._v(a._s(a.valido?a.dialogIngreso.remito_compra?"Guardar":"Crear":"Formulario No valido")+" ")],1)],1)],1)],1)],1)},T=[];e(7658);const I={name:"dialogIngreso",props:["closeFinish"],components:{dateSelect:E.Z},data:()=>({valido:!0,cargaInicial:!1,farmaciaProveedores:[],insumosDB:[],areasFiltro:[],dataEdit:{},dataEditBase:{fecha:"",remito_compra:"",proveedor:"primerCarga",destino:"",orden_compra:"",insumos:[{insumo:void 0,cantidad:null,procedencia:"",lote:"",vencimiento:""}],observacion:"",recibido:""}}),computed:{...(0,_.rn)(["loading","hoy","persona","rules"]),...(0,_.rn)("farmacia",["dialogIngreso","ingresoProcedencia"])},watch:{async"dialogIngreso.state"(a){a?setTimeout((async()=>{this.farmaciaProveedores=[...this.ingresoProcedencia.slice(1,-1)],(this.persona.farmacia?.proveedores||this.persona.farmacia?.general?.admin)&&this.farmaciaProveedores.push(...await this.returnConfig("farmaciaProveedores")||[]),this.farmaciaProveedores.push({text:"Carga inicial",disabled:!0}),this.insumosDB=await this.buscarInsumosFiltro({select:"nombre descripcion nombreC"});let a=[...await this.buscarAreaFiltros({filtro:{farmacia:!0},populate:"no",select:"area"})];if(this.areasFiltro=this.persona.farmacia?.general?.admin?a:await this.filtrarArrayParaSelectsDisabled({arraySelects:a,arrayEnable:this.persona.farmacia?.gestion,propCompare:"_id"}),this.dialogIngreso.remito_compra){let a=this._cloneDeep(this.dialogIngreso.remito_compra);for(let t=0;t<a.insumos.length;t++)a.insumos[t].vencimiento=this.mostrarFecha(a.insumos[t].vencimiento);this.dataEdit=Object.assign(this._cloneDeep(this.dataEditBase),a)}else this.dataEdit=this._cloneDeep(this.dataEditBase),this.cargaInicial=!1,this.dataEdit.fecha=Date.now(),this.dataEdit.remito_compra=this.hoy.substring(0,5),this.persona.farmacia?.general?.admin||1!==this.persona.farmacia?.gestion?.length||(this.dataEdit.destino=this.persona.farmacia?.gestion[0]);this.$refs.form.resetValidation()}),350):(this.dataEdit=this._cloneDeep(this.dataEditBase),this.$refs.form.resetValidation())},cargaInicial(a){a?(this.dataEdit.remito_compra="Carga inicial",this.dataEdit.proveedor="Carga inicial",this.dataEdit.orden_compra="Carga inicial"):(this.dataEdit.remito_compra=this.hoy.substring(0,5),this.dataEdit.proveedor=void 0,this.dataEdit.orden_compra="")},"dataEdit.remito_compra"(a){"Carga inicial"===a&&(this.dataEdit.proveedor="Carga inicial",this.dataEdit.orden_compra="Carga inicial",this.cargaInicial=!0)},"dataEdit.orden_compra"(a){"Carga inicial"===a&&(this.dataEdit.remito_compra="Carga inicial",this.dataEdit.proveedor="Carga inicial",this.cargaInicial=!0)},"dataEdit.proveedor"(a,t){let e="";if(a){if(this.dialogIngreso.remito_compra&&"primerCarga"===t)return;e="Municipal","Carga inicial"===a?(this.dataEdit.remito_compra="Carga inicial",this.dataEdit.orden_compra="Carga inicial",this.cargaInicial=!0,e="Carga inicial"):"Remediar"===a?e="Remediar":"SUMAR"===a?e="SUMAR":"Region"===a?e="Region":"Nacion"===a?e="Nacion":"Donacion"===a?e="Donacion":"PURPSI"===a?e="PURPSI":"Open Door"===a&&(e="Open Door")}for(let i=0;i<this.dataEdit.insumos.length;i++)this.dataEdit.insumos[i].procedencia=e}},beforeMount(){this.dataEdit=this._cloneDeep(this.dataEditBase)},methods:{...(0,_.OI)(["mostrarLoading","mostrarError","mostrarMensaje","ocultarLoading"]),...(0,_.nv)(["requestAPI","returnConfig","filtrarArrayParaSelectsDisabled"]),...(0,_.nv)("main_areas",["buscarAreaFiltros"]),...(0,_.nv)("farmacia",["actualizarDialogIngresoTransferencia","buscarInsumosFiltro"]),close(){this.actualizarDialogIngresoTransferencia({state:!1,type:{ingreso:!0}}),this.closeFinish?.()},agregarFila(a,t){a.push(t||"")},borrarFila(a,t){a.splice(t,1)},async guardarIngreso(){if(!this.$refs.form.validate())return this.mostrarError({mensaje:"Revise los campos obligatorios.",titulo:"Valores Requeridos."}),!1;try{this.mostrarLoading({titulo:"Efectuando cambios..."});let a=this._cloneDeep(this.dataEdit);if(!a._id){let t=this.isVacio(a,!0);if(!0===t.vacio)return this.mostrarError({mensaje:"Complete por lo menos un dato.",titulo:"Valores Requeridos"}),!1;a=t.dato}a._id&&(a.insumos=this.isVacio(a.insumos,!0).dato);for(let e=0;e<a.insumos.length;e++)if(a.insumos[e].lote&&(a.insumos[e].lote=a.insumos[e].lote.toUpperCase()),a.insumos.filter((t=>t.insumo===a.insumos[e].insumo&&t.vencimiento===a.insumos[e].vencimiento&&t.lote===a.insumos[e].lote)).length>1)return this.mostrarError({mensaje:`Insumo ya cargado, repetido en este mismo ingreso.\n                　${this.insumosDB.find((t=>t._id===a.insumos[e].insumo)).nombre}\n                　L: ${a.insumos[e].lote??"---"}\n                　V: ${a.insumos[e].vencimiento??"---"}`,titulo:"Valores Repetidos"}),this.dataEdit=a,!1;let t=null;if(t=await this.requestAPI({method:"put",url:"/farmacia/ingreso",update:a}),t?.data?.ok){let t=a._id?"Editado":"Guardado";return this.mostrarMensaje({msj:[`Ingreso ${t} exitosamente.`],titulo:"Completado"}),this.close(),!0}return!1}catch(a){return this.mostrarError({mensaje:a,titulo:"Inesperado (guardarIngreso)"}),!1}finally{this.ocultarLoading()}},async borrarIngreso(){if(await this.$root.$confirm.open({titulo:"ELIMINAR",msj:["Una vez Eliminado no se podra recuperar.",`El Ingreso: ${this.dataEdit.remito_compra}, sera ELIMINADO.\n¿Desea continuar?`]}))try{this.mostrarLoading({titulo:"Borrando Ingreso..."});let a=null;return a=await this.requestAPI({method:"delete",url:`/farmacia/ingreso/${this.dataEdit._id}`}),!!a?.data?.ok&&(this.mostrarMensaje({msj:["Borrado exitosamente."],titulo:"Borrado Exitoso"}),this.close(),!0)}catch(a){return this.mostrarError({mensaje:a,titulo:"Inesperado (borrarIngreso)"}),!1}finally{this.ocultarLoading()}}}},A=I;var B=e(1001),L=(0,B.Z)(A,F,T,!1,null,null,null);const $=L.exports;var R=e(3849),z=e(3718);const q={name:"farmaciaIngresoBuscar",components:{dateSelect:E.Z,bodyDataTableDinamic:k.Z,dialogIngreso:$,dialogTransferencia:R.Z,componentFiltroAvanzado:z.Z},data:()=>({areasFiltro:[],noAdminNoGestion:!1,noAdminSiGestion:!1,dataTable:[],dataTableSelected:"Todos",dataTableSelect:["Todos","Aptos para que Recibamos","Transiciones Incompletas","Transiciones Finalizadas"],filtro:{desde:"",hasta:"",areas:[],insumos:[],procedencias:[]},ultimoFiltro:{},search:"",paginacion:{sortBy:"fecha",descending:!0,rowsPerPage:10,page:1},headers:[{text:"Acciones",value:"id",align:"center",sortable:!1,width:"5%",ignore:!0},{text:"Fecha",value:"fecha",align:"left",class:"text-xs-left",width:"15%",ruta:"fecha",date:!0,time:!0},{text:"Remito de Compra",value:"remito_compra",align:"left",class:"text-xs-right",width:"15%",ruta:"remito_compra"},{text:"Procedencia / Proveedor",value:"proveedor",align:"left",class:"text-xs-left",width:"15%",ruta:"proveedor"},{text:"Remito Transf.",value:"remito",align:"left",class:"text-xs-right",width:"15%",ruta:"remito"},{text:"Transf. Origen",value:"origenDB",align:"left",class:"text-xs-left",width:"15%",ruta:"origenDB"},{text:"Destino",value:"destinoDB",align:"left",class:"text-xs-left",width:"20%",ruta:"destinoDB"},{text:"Recibido Destino",value:"recibido",align:"left",class:"text-xs-left",width:"10%",ruta:"recibido",date:!0,time:!0},{text:"Retirado Origen",value:"retirado",align:"left",class:"text-xs-left",width:"10%",ruta:"retirado",date:!0,time:!0}]}),computed:{...(0,_.rn)(["loading","hoy","monthBefore","persona"]),headersDinamics(){return[...this.headers.filter((a=>!0!==a.ignore))]},dataTableFilter(){return this.dataTable?.filter((a=>{if("Todos"===this.dataTableSelected)return!0;if("Transiciones Finalizadas"===this.dataTableSelected&&a.recibido)return!0;if("Transiciones Incompletas"===this.dataTableSelected&&!a.recibido)return!0;if("Aptos para que Recibamos"===this.dataTableSelected&&!a.recibido){if(a.origen&&!a.retirado)return!1;if(this.persona.farmacia.general?.admin||this.noAdminSiGestion&&this.persona.farmacia.gestion.includes(a.destino))return!0}return!1}))}},watch:{dataTableFilter(){this.paginacion.page>Math.ceil(this.dataTableFilter?.length/this.paginacion.rowsPerPage)&&(this.paginacion.page=1)}},async created(){this.filtro.desde=this.monthBefore,this.filtro.hasta=this.hoy,this.persona.farmacia.general?.admin||(this.persona.farmacia.gestion?this.noAdminSiGestion=!0:this.noAdminNoGestion=!0);let a=[...await this.buscarAreaFiltros({filtro:{farmacia:!0},populate:"no",select:"area"})];this.persona.farmacia.general?.reportes||this.persona.farmacia.general?.admin?(this.areasFiltro=a,this.filtro.areas=a.map((a=>a.id))):(this.areasFiltro=await this.filtrarArrayParaSelectsDisabled({arraySelects:a,arrayEnable:this.persona.farmacia.gestion,propCompare:"_id"}),this.filtro.areas=[...this.persona.farmacia.gestion]),await this.recargarDataTable(this.filtro)},methods:{...(0,_.OI)(["mostrarLoading","mostrarError","ocultarLoading","mostrarDialogIframe"]),...(0,_.nv)(["retroceder","routerResolve","filtrarArrayParaSelectsDisabled","requestAPI"]),...(0,_.nv)("main_areas",["buscarAreaFiltros"]),...(0,_.nv)("farmacia",["actualizarDialogIngresoTransferencia","getRequestFilter","recibirIngreso"]),backgroundClass(a){if(!a)return"";try{return a.recibido?"background-color: green lighten-5":this.noAdminNoGestion&&!this.persona.farmacia.general?.admin?"background-color: grey lighten-4":a.origen&&!a.retirado&&(this.persona.farmacia.general?.admin||this.noAdminSiGestion&&this.persona.farmacia.gestion.includes(a.origen))?"background-color: yellow lighten-4":this.persona.farmacia.general?.admin||this.noAdminSiGestion&&this.persona.farmacia.gestion.includes(a.destino)?"background-color: orange lighten-4":"background-color: grey lighten-4"}catch(t){return""}},customFilter(a,t){return t&&a.length>0?this.objectSearch({items:a,search:t,propCompare:["fecha","remito_compra","orden_compra","proveedor","remito","origenDB","destinoDB","recibido","retirado"]}):a},async recargarDataTable(a){if(a){let t=await this.buscarIngresosAgrupados(a);t&&(this.dataTable=t,this.ultimoFiltro=this._cloneDeep(a))}else this.dataTable=await this.buscarIngresosAgrupados(this.ultimoFiltro)},async buscarIngresosAgrupados(a){try{this.mostrarLoading({titulo:"Buscando Ingresos..."});let t=await this.getRequestFilter({payload:a});if(t.error)return;let e=null;return e=await this.requestAPI({method:"get",url:`/farmacia/ingresos?${t.dato}`}),e?.data?.ok?e.data.ingresos:[{remito_compra:"error de carga, recargar pagina",id:void 0}]}catch(t){return this.mostrarError({mensaje:t,titulo:"Inesperado (buscarIngresosAgrupados)"}),[{remito_compra:"error de carga(buscarIngresosAgrupados), recargar pagina",id:void 0}]}finally{this.ocultarLoading()}},async reporte(){if(this.filtro.areas.length>0){localStorage.setItem("pdfTemp",JSON.stringify(this.filtro));let a=await this.routerResolve({name:"FarmaciaIngresosImprimir",query:{descarga:!1}});this.mostrarDialogIframe({src:a.href,titulo_name:`Farmacia Ingresos ${this.filtro.desde} ~ ${this.filtro.hasta}`})}else this.mostrarError({errores:"",mensaje:"Complete por lo menos con una Farmacia para el reporte.",titulo:"Valores Requeridos."})}}},j=q;var P=(0,B.Z)(j,y,x,!1,null,null,null);const O=P.exports},9770:(a,t,e)=>{e.r(t),e.d(t,{default:()=>j});var i=e(8469),r=e(7416),o=e(6194),s=e(8956),n=e(2353),l=e(9418),d=e(5050),c=e(7352),u=e(108),m=e(683),g=e(3667),h=e(9456),p=e(6446),f=e(8143),b=e(4618),v=e(1415),y=function(){var a=this,t=a._self._c;return t(d.Z,{attrs:{fluid:"","grid-list-xs":""}},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"","text-xs-center":""}},[t(m.Z,{attrs:{"pa-1":"","ma-1":"",cuarto:"",xs12:""}},[t(s.Z,{staticClass:"white--text",attrs:{color:"cuarto darken-2"}},[t(n.ZB,{staticClass:"px-0 text-uppercase"},[a._v("====== Gestion de Farmacia ======")])],1)],1)],1),t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":""}},[t(m.Z,{attrs:{"pa-1":"","ma-1":"",cuarto:"",xs12:""}},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"",cuarto:"","darken-1":""}},[t(m.Z,{attrs:{"px-3":""}},[t(g.Z,{attrs:{medium:"",color:"white",left:""}},[a._v("medication")]),t("span",{staticClass:"title white--text"},[a._v("Farmacia / Solicitudes")])],1),t(f.Cl),t(o.Z,{attrs:{fab:"",small:"",color:"primary darken-2"},on:{click:function(t){return a.retroceder()}}},[t(g.Z,[a._v("far fa-arrow-alt-circle-left")])],1)],1),t(s.Z,{staticClass:"elevation-6",attrs:{color:"grey lighten-2"}},[t(n.ZB,{staticClass:"px-0"},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"","text-xs-center":""}},[t(m.Z,{attrs:{xs12:"","px-3":""}},[t(s.Z,{staticClass:"grey lighten-3"},[t(h.Z,{attrs:{"justify-center":"",row:"",wrap:""},on:{keypress:function(t){return!t.type.indexOf("key")&&a._k(t.keyCode,"enter",13,t.key,"Enter")?null:a.recargarDataTable(a.filtro)}}},[t(m.Z,{attrs:{xs12:"",sm6:"",md3:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{value:a.filtro.desde,"background-color":"cuarto lighten-5",color:"cuarto",label:"Desde",icon:"today",max:a.filtro.hasta,requerido:"true"},model:{value:a.filtro.desde,callback:function(t){a.$set(a.filtro,"desde",t)},expression:"filtro.desde"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"",md3:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{value:a.filtro.hasta,"background-color":"cuarto lighten-5",color:"cuarto",label:"Hasta",icon:"event",min:a.filtro.desde,requerido:"true"},model:{value:a.filtro.hasta,callback:function(t){a.$set(a.filtro,"hasta",t)},expression:"filtro.hasta"}})],1),t(m.Z,{attrs:{xs12:"",md10:"","px-3":"","mb-3":""}},[t("componentFiltroAvanzado",{attrs:{filtro:a.filtro,areasFiltro:a.areasFiltro,insumos:{select:"nombre descripcion nombreC"}}})],1)],1),t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":""}},[t(o.Z,{staticClass:"white--text mb-2",attrs:{round:"",color:"cuarto darken-2",disabled:a.loading.estado,loading:a.loading.estado},on:{click:function(t){return a.recargarDataTable(a.filtro)}}},[t(g.Z,{attrs:{medium:"",left:""}},[a._v("search")]),a._v(" Buscar Solicitudes")],1),t(u.Z,{staticClass:"hidden-xs-only mx-4 my-1 black",attrs:{vertical:""}}),t(o.Z,{staticClass:"white--text mb-2",attrs:{round:"",color:"cuarto darken-2",disabled:a.loading.estado,loading:a.loading.estado},on:{click:function(t){return a.reporte()}}},[t(g.Z,{attrs:{medium:"",left:""}},[a._v("fa-solid fa-file-pdf")]),a._v(" Solicitudes Pendientes PDF")],1)],1)],1)],1)],1)],1)],1)],1),t(m.Z,{attrs:{"pa-1":"","ma-1":"",xs12:"",cuarto:"","lighten-1":""}},[t(s.Z,{staticClass:"elevation-6"},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"",primary:""}},[t(m.Z,{attrs:{"px-3":""}},[t(g.Z,{attrs:{medium:"",color:"white",left:""}},[a._v("speaker_notes")]),t("span",{staticClass:"title white--text"},[a._v("Solicitudes de Insumos")])],1),t(f.Cl)],1),t(l.Z,[t(m.Z,{attrs:{xs12:"",sm4:"","px-2":""}},[t(b.h,{attrs:{"append-icon":"search",label:"Buscar","single-line":"","hide-details":"",clearable:""},model:{value:a.search,callback:function(t){a.search=t},expression:"search"}})],1),t(f.Cl),t(m.Z,{attrs:{xs12:"",sm6:"",md4:"","px-2":""}},[t(r.Z,{staticClass:"capitalizar",attrs:{items:a.dataTableSelect,label:"Mostrar","prepend-icon":"list_alt",color:"cuarto","background-color":"cuarto lighten-5"},model:{value:a.dataTableSelected,callback:function(t){a.dataTableSelected=t},expression:"dataTableSelected"}})],1),t(u.Z,{staticClass:"hidden-xs-only mx-2 my-1 primary",attrs:{vertical:""}}),t(o.Z,{staticClass:"mb-2",attrs:{round:"",color:"primary",disabled:a.loading.estado||!(a.persona.farmacia.gestion?.length>0||a.persona.farmacia.general?.admin),loading:a.loading.estado},on:{click:function(t){return a.actualizarDialogSolicitud({state:!0})}}},[t(g.Z,{attrs:{medium:"",left:""}},[a._v("input")]),a._v(" Nueva Solicitud")],1)],1),t(c.Z,{staticClass:"elevation-6",staticStyle:{"table-layout":"fixed"},attrs:{id:"tablita",headers:a.headers,items:a.dataTableFilter,"item-key":"_id",pagination:a.paginacion,"rows-per-page-items":[5,10,25,50],loading:a.loading.estado,search:a.search},on:{"update:pagination":function(t){a.paginacion=t}},scopedSlots:a._u([{key:"no-results",fn:function(){return[t(i.Z,{staticClass:"text-sm-left",attrs:{value:!0,color:"error",icon:"warning"}},[a._v(' No se encontraron resultados para "'+a._s(a.search)+'". ')])]},proxy:!0},{key:"no-data",fn:function(){return[t(i.Z,{staticClass:"text-sm-left",attrs:{value:!0,color:"error",icon:"warning"}},[a._v(" No hay datos para mostrar. ")])]},proxy:!0},{key:"items",fn:function(e){return[t("tr",{class:a.backgroundClass(e.item)},[t("td",{staticClass:"text-sm-left"},[t("div",{staticClass:"text-xs-center"},[t(v.Z,{attrs:{right:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:i}){return[t(o.Z,a._g({attrs:{disabled:a.loading.estado,color:"white",small:"",icon:""},on:{click:function(t){return a.actualizarDialogSolicitud({state:!0,solicitud:e.item})}}},i),[t(g.Z,{attrs:{color:"primary"}},[a._v("visibility")])],1)]}}],null,!0)},[t("span",[a._v("Ver Solicitud")])])],1)]),a._l(a.headersDinamics,(function(i){return t("td",{key:i.text,class:i.class,staticStyle:{cursor:"pointer"},on:{click:function(t){return a.actualizarDialogSolicitud({state:!0,solicitud:e.item})}}},[t("bodyDataTableDinamic",{attrs:{props:e,field:i}})],1)}))],2)]}}])},[t(p.Z,{attrs:{color:"blue",indeterminate:""}})],1)],1)],1),t(m.Z,{attrs:{"pa-1":"","ma-1":"",red:"","darken-2":"",xs12:""}},[t(s.Z,[t(n.ZB,{staticClass:"px-3 font-weight-medium"},[t("p",[t(g.Z,{attrs:{color:"yellow darken-3",left:""}},[a._v(" warning ")]),t("b",[t("u",[a._v("Referencia de Colores:")])])],1),t("ul",[t("li",{staticClass:"green--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Verde:")])]),a._v(" Solicitudes de Insumos "),t("b",[t("u",[a._v("Aceptadas")])]),a._v(". ")]),t("li",{staticClass:"blue--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Celeste:")])]),a._v(" Solicitudes de Insumos Pendientes con motivo de "),t("b",[t("u",[a._v("Rutina")])]),a._v(". ")]),t("li",{staticClass:"orange--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Anaranjado:")])]),a._v(" Solicitudes de Insumos Pendientes con motivo de "),t("b",[t("u",[a._v("Emergencia")])]),a._v(". ")]),t("li",{staticClass:"text-yellow-shadow",attrs:{type:"square"}},[t("b",[t("u",[a._v("Amarillo:")])]),a._v(" Solicitudes de Insumos Pendientes con motivo de "),t("b",[t("u",[a._v("Urgencia")])]),a._v(". ")]),t("li",{staticClass:"red--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Rojo:")])]),a._v(" Solicitudes de Insumos "),t("b",[t("u",[a._v("Rechazadas")])]),a._v(". ")])])])],1)],1)],1),t("dialogSolicitud",{attrs:{closeFinish:a.recargarDataTable}})],1)},x=[],_=e(629),E=e(3979),k=e(5716),Z=e(5049),w=e(445),D=e(4920),S=e(5730),C=function(){var a=this,t=a._self._c;return t(Z.Z,{attrs:{"max-width":"80%",persistent:"",scrollable:""},model:{value:a.dialogSolicitud.state,callback:function(t){a.$set(a.dialogSolicitud,"state",t)},expression:"dialogSolicitud.state"}},[t(s.Z,[t(D.Z,{attrs:{color:"grey lighten-2",height:"auto",window:""}},[t(g.Z,{attrs:{medium:"",color:"black darken-2"}},[a._v("speaker_notes")]),t("span",{staticClass:"display-1 font-weight-bold text-capitalize black--text text--darken-2"},[a._v(a._s(a.dialogSolicitud.solicitud?"Solicitud":"Nueva Solicitud"))]),t(f.Cl),t(g.Z,{attrs:{large:"",disabled:a.loading.estado,color:"error darken-1"},on:{click:a.close}},[a._v("cancel_presentation")])],1),t(n.ZB,[t(w.Z,{ref:"form",attrs:{"lazy-validation":""},model:{value:a.valido,callback:function(t){a.valido=t},expression:"valido"}},[t(d.Z,{attrs:{"grid-list-md":"","pa-0":""}},[t(h.Z,{attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},[t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(b.h,{attrs:{readonly:"","background-color":"primary lighten-1",value:a.mostrarFecha(a.dataEdit.fecha,"time"),"prepend-icon":"event",label:"Fecha",type:"text",color:"primary"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(r.Z,{attrs:{readonly:a.dialogSolicitud.soloLectura,clearable:!a.dialogSolicitud.soloLectura,"background-color":`${"Pendiente"===a.dataEdit.estado?"yellow":"Rechazada"===a.dataEdit.estado?"red":"green"} ${a.dialogSolicitud.soloLectura?"lighten-1":"lighten-4"}`,items:a.solicitudEstados,label:"Estado","prepend-icon":"Aceptada"===a.dataEdit.estado?"check_box":"Rechazada"===a.dataEdit.estado?"disabled_by_default":"check_box_outline_blank",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},on:{change:function(t){return a.getCantidadStock()}},model:{value:a.dataEdit.estado,callback:function(t){a.$set(a.dataEdit,"estado",t)},expression:"dataEdit.estado"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(r.Z,{attrs:{readonly:a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada,clearable:!(a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada),"background-color":`${"Rutina"===a.dataEdit.motivo?"blue":"Urgencia"===a.dataEdit.motivo?"yellow":"orange"} ${a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada?"lighten-1":"lighten-4"}`,items:a.solicitudMotivos,label:"Motivo","prepend-icon":"speaker_notes",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},model:{value:a.dataEdit.motivo,callback:function(t){a.$set(a.dataEdit,"motivo",t)},expression:"dataEdit.motivo"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(r.Z,{staticClass:"capitalizar",attrs:{readonly:a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada,clearable:!(a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada),"background-color":a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada?"primary lighten-1":"primary lighten-5","item-value":"id","item-text":"area",items:a.areasFiltro,label:"Origen","prepend-icon":"fa-house-medical-flag",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},on:{change:function(t){return a.getCantidadStock()}},model:{value:a.dataEdit.origen,callback:function(t){a.$set(a.dataEdit,"origen",t)},expression:"dataEdit.origen"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(r.Z,{staticClass:"capitalizar",attrs:{readonly:a.dialogSolicitud.soloLectura||"Pendiente"===a.dataEdit.estado&&a.dialogSolicitud.edicionLimitada,clearable:!(a.dialogSolicitud.soloLectura||"Pendiente"===a.dataEdit.estado&&a.dialogSolicitud.edicionLimitada),"background-color":a.dialogSolicitud.soloLectura||"Pendiente"===a.dataEdit.estado&&a.dialogSolicitud.edicionLimitada?"primary lighten-1":"primary lighten-5","item-value":"id","item-text":"area",items:"Aceptada"===a.dataEdit.estado?a.areasFiltroDestino:"Rechazada"===a.dataEdit.estado?a.areasFiltro:a.areasDB,label:""+("Aceptada"===a.dataEdit.estado?"Aceptada por:":"Rechazada"===a.dataEdit.estado?"Rechazada por:":"Destinatario (Opcional)"),"prepend-icon":"fa-solid fa-dolly",color:"primary",rules:"Aceptada"===a.dataEdit.estado||"Rechazada"===a.dataEdit.estado?[...a.rules.requerido]:[],"validate-on-blur":""},on:{"click:clear":function(t){a.$nextTick((()=>a.dataEdit.destino=""))}},model:{value:a.dataEdit.destino,callback:function(t){a.$set(a.dataEdit,"destino",t)},expression:"dataEdit.destino"}})],1),t(m.Z,{attrs:{xs12:"","px-3":"",primary:"","darken-3":""}},[t("h4",{staticClass:"title float: left white--text"},[a._v("Insumos a Solicitar")])]),a._l(a.dataEdit.insumos,(function(e,i){return t(m.Z,{key:`insumos-${i}`,attrs:{xs12:""}},[t(h.Z,{class:"grey lighten-"+(i%2===0?"3":"2"),attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},[t(m.Z,{class:"xs12 "+("Pendiente"===a.dataEdit.estado?"lg6":"lg8"),attrs:{"px-3":""}},[t(r.Z,{staticClass:"capitalizar",attrs:{readonly:a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada,clearable:!(a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada),"background-color":a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada?"primary lighten-1":"primary lighten-5","item-value":"id","item-text":"nombreC",items:a.insumosFiltrado,label:"Insumo","prepend-icon":"fa-solid fa-pills",color:"primary",rules:[...a.rules.requerido],"validate-on-blur":""},on:{"click:clear":function(t){a.$nextTick((()=>a.dataEdit.insumos[i].insumo=""))},change:function(t){return a.getCantidadStock()}},model:{value:a.dataEdit.insumos[i].insumo,callback:function(t){a.$set(a.dataEdit.insumos[i],"insumo",t)},expression:"dataEdit.insumos[index].insumo"}})],1),"Pendiente"===a.dataEdit.estado?t(m.Z,{attrs:{xs12:"",sm4:"",md3:"",lg2:"","px-3":""}},[t(b.h,{attrs:{readonly:"","background-color":"primary lighten-3",value:a.dataEdit.insumos[i].stock,"prepend-icon":"warehouse",label:"Tienen"}})],1):a._e(),t(m.Z,{class:"xs12 "+("Pendiente"===a.dataEdit.estado?"sm6 lg3":"sm8 lg3"),attrs:{"px-3":""}},[t(b.h,{attrs:{readonly:a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada,clearable:!(a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada),"background-color":a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada?"primary lighten-1":"primary lighten-5","prepend-icon":"grain",label:"Cantidad Solicitada",type:"number",onkeydown:"return event.key !== 'e' && event.key !== 'E' && event.key !== '.' && event.key !== ',' && event.key !== '+' && event.key !== '-'",color:"primary",rules:[...a.rules.requerido,...a.rules.soloNumero,a.rules.minNumber(1)],"validate-on-blur":""},model:{value:a.dataEdit.insumos[i].cantidad,callback:function(t){a.$set(a.dataEdit.insumos[i],"cantidad",t)},expression:"dataEdit.insumos[index].cantidad"}})],1),t(f.Cl),0==i?t(v.Z,{attrs:{top:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:e}){return[t(o.Z,a._g({attrs:{disabled:a.loading.estado||a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada,fab:"",small:"",color:"primary"},on:{click:function(t){return a.agregarFila(a.dataEdit.insumos,{...a.dataEditBase.insumos[0]})}}},e),[t(g.Z,{attrs:{"x-large":""}},[a._v("control_point")])],1)]}}],null,!0)},[t("span",[a._v("Agregar Insumo Solicitar")])]):a._e(),0!=i?t(v.Z,{attrs:{top:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:e}){return[t(o.Z,a._g({attrs:{disabled:a.loading.estado||a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada,small:"",icon:"",color:"white"},on:{click:function(t){return a.borrarFila(a.dataEdit.insumos,i)}}},e),[t(g.Z,{attrs:{color:"red lighten-2"}},[a._v("delete_forever")])],1)]}}],null,!0)},[t("span",[a._v("Eliminar Insumo")])]):a._e(),t(f.Cl,{staticClass:"hidden-xs-only"})],1)],1)}))],2),t(h.Z,{attrs:{"align-center":"","justify-center":"",row:"",wrap:""}},["Aceptada"===a.dataEdit.estado||"Rechazada"===a.dataEdit.estado?t(m.Z,{attrs:{xs12:"",sm6:"","px-3":""}},[t(b.h,{attrs:{readonly:"","background-color":"primary lighten-1",value:a.mostrarFecha(a.dataEdit.fec_resolucion,"time"),"prepend-icon":"event",label:"Fecha de Resolucion",type:"text",color:"primary"}})],1):a._e(),"Aceptada"===a.dataEdit.estado?t(m.Z,{attrs:{xs12:"","mx-2":""}},[t(S.Z,{attrs:{readonly:a.dialogSolicitud.soloLectura,clearable:!a.dialogSolicitud.soloLectura,"background-color":a.dialogSolicitud.soloLectura?"primary lighten-1":"primary lighten-5",label:"Condicion con la que se acepto (Opcional)",placeholder:"Si de alguno de los insumos se enviara menor cantidad, completar aca para avisar.",color:"primary","prepend-icon":"speaker_notes","auto-grow":"",rows:"2"},model:{value:a.dataEdit.condicion_aceptada,callback:function(t){a.$set(a.dataEdit,"condicion_aceptada",t)},expression:"dataEdit.condicion_aceptada"}})],1):a._e(),"Rechazada"===a.dataEdit.estado?t(m.Z,{attrs:{xs12:"","mx-2":""}},[t(S.Z,{attrs:{readonly:a.dialogSolicitud.soloLectura,clearable:!a.dialogSolicitud.soloLectura,"background-color":a.dialogSolicitud.soloLectura?"primary lighten-1":"primary lighten-5",label:"Motivo de Rechazo",color:"primary","prepend-icon":"speaker_notes","auto-grow":"",rows:"2",rules:[...a.rules.requerido],"validate-on-blur":""},model:{value:a.dataEdit.motivo_rechazo,callback:function(t){a.$set(a.dataEdit,"motivo_rechazo",t)},expression:"dataEdit.motivo_rechazo"}})],1):a._e()],1)],1)],1)],1),t(n.h7,[t(h.Z,{attrs:{row:"",wrap:""}},[t(o.Z,a._g({attrs:{disabled:a.loading.estado||a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada,round:"",color:"primary"},on:{click:function(t){return a.agregarFila(a.dataEdit.insumos,{...a.dataEditBase.insumos[0]})}}},a.on),[t(g.Z,{attrs:{left:""}},[a._v("control_point")]),a._v("insumo Solicitar ")],1),t(f.Cl),a.dataEdit._id?t(o.Z,{staticClass:"black darken-1 orange--text",attrs:{disabled:a.loading.estado||a.dialogSolicitud.soloLectura||a.dialogSolicitud.edicionLimitada,round:"",loading:a.loading.estado},on:{click:function(t){return a.borrarSolicitud()}}},[t(g.Z,{attrs:{color:"red lighten-2",left:""}},[a._v("delete_forever")]),a._v("Borrar ")],1):a._e(),t(f.Cl),t(o.Z,{staticClass:"red darken-1 white--text",attrs:{disabled:a.loading.estado,round:"",loading:a.loading.estado},on:{click:function(t){return a.close()}}},[t(g.Z,{attrs:{left:""}},[a._v("cancel_presentation")]),a._v("Cancelar ")],1),t(o.Z,{staticClass:"primary darken-1 white--text",attrs:{disabled:a.loading.estado||a.dialogSolicitud.soloLectura,loading:a.loading.estado,round:""},on:{click:function(t){return a.guardarSolicitud()}}},[t(g.Z,{attrs:{left:""}},[a._v("save")]),a._v(a._s(a.valido?a.dialogSolicitud.solicitud?"Guardar":"Crear":"Formulario No valido")+" ")],1)],1)],1)],1)],1)},F=[];e(7658);const T={name:"dialogSolicitud",props:["closeFinish"],components:{},data:()=>({valido:!0,areasDB:[],areasFiltro:[],areasFiltroDestino:[],insumosDB:[],insumosFiltrado:[],dataEdit:{},dataEditBase:{fecha:"",origen:"",destino:"",insumos:[{insumo:void 0,cantidad:null,stock:null}],estado:"Pendiente",motivo:"Rutina",fec_resolucion:"",condicion_aceptada:"",motivo_rechazo:""},solicitudEstados:["Pendiente","Aceptada","Rechazada"],solicitudMotivos:["Rutina","Urgencia","Emergencia"]}),computed:{...(0,_.rn)(["loading","persona","rules"]),...(0,_.rn)("farmacia",["dialogSolicitud"]),stockASolicitar(){return this.dataEdit.insumos?.map((a=>a.insumo))}},watch:{async"dialogSolicitud.state"(a){a?setTimeout((async()=>{this.insumosDB=await this.buscarInsumosFiltro({select:"nombre descripcion nombreC"}),this.insumosFiltrado=await this.filtrarArrayParaSelectsDisabled({arraySelects:this.insumosDB,arrayDisable:this.stockASolicitar,propCompare:"id"}),this.areasDB.push(...await this.buscarAreaFiltros({filtro:{farmacia:!0},populate:"no",select:"area"})),this.areasFiltro=this.persona.farmacia.general?.admin?this.areasDB:await this.filtrarArrayParaSelectsDisabled({arraySelects:this.areasDB,arrayEnable:this.persona.farmacia.gestion,propCompare:"_id"}),this.dialogSolicitud.solicitud?(this.dataEdit=Object.assign(this._cloneDeep(this.dataEditBase),this._cloneDeep(this.dialogSolicitud.solicitud)),this.getCantidadStock()):(this.dataEdit=this._cloneDeep(this.dataEditBase),this.dataEdit.fecha=Date.now(),this.persona.farmacia?.general?.admin||1!==this.persona.farmacia?.gestion?.length||(this.dataEdit.origen=this.persona.farmacia?.gestion[0])),this.$refs.form.resetValidation()}),350):(this.dataEdit=this._cloneDeep(this.dataEditBase),this.$refs.form.resetValidation())},"dataEdit.estado"(a){"Aceptada"===a||"Rechazada"===a?(this.dataEdit.fec_resolucion||(this.dataEdit.fec_resolucion=Date.now(),this.dataEdit.destino=""),"Aceptada"===a&&(this.changeAreasFiltroDestino(),this.dataEdit.origen===this.dataEdit.destino&&(this.dataEdit.destino=""))):"Pendiente"===a&&this.dataEdit.fec_resolucion&&(this.dataEdit.fec_resolucion="",this.dataEdit.destino=""),"Aceptada"!==a&&(this.dataEdit.condicion_aceptada=""),"Rechazada"!==a&&(this.dataEdit.motivo_rechazo="")},"dataEdit.origen"(a){a&&"Aceptada"===this.dataEdit.estado&&(this.changeAreasFiltroDestino(),this.dataEdit.origen===this.dataEdit.destino&&(this.dataEdit.destino=""))},async stockASolicitar(a){this.insumosFiltrado=await this.filtrarArrayParaSelectsDisabled({arraySelects:this.insumosDB,arrayDisable:a,propCompare:"id"})}},beforeMount(){this.dataEdit=this._cloneDeep(this.dataEditBase)},methods:{...(0,_.OI)(["mostrarLoading","mostrarError","mostrarMensaje","ocultarLoading"]),...(0,_.nv)(["filtrarArrayParaSelectsDisabled","requestAPI"]),...(0,_.nv)("main_areas",["buscarAreaFiltros"]),...(0,_.nv)("farmacia",["actualizarDialogSolicitud","buscarInsumosFiltro"]),async changeAreasFiltroDestino(){this.areasFiltroDestino=await this.filtrarArrayParaSelectsDisabled({arraySelects:this.areasFiltro,arrayDisable:this.dataEdit.origen,propCompare:"_id"})},close(){this.actualizarDialogSolicitud({state:!1}),this.closeFinish?.()},agregarFila(a,t){a.push(t||"")},borrarFila(a,t){a.splice(t,1)},async guardarSolicitud(){if(!this.$refs.form.validate())return this.mostrarError({mensaje:"Revise los campos obligatorios.",titulo:"Valores Requeridos."}),!1;try{this.mostrarLoading({titulo:"Efectuando cambios..."});let a=this._cloneDeep(this.dataEdit);if(!a._id){let t=this.isVacio(a,!0);if(!0===t.vacio)return this.mostrarError({mensaje:"Complete por lo menos un dato.",titulo:"Valores Requeridos"}),!1;a=t.dato}let t=null;if(t=await this.requestAPI({method:"put",url:"/farmacia/solicitud",update:a}),t?.data?.ok){let t=a._id?"Editada":"Guardada";return this.mostrarMensaje({msj:[`Solicitud ${t} exitosamente.`],titulo:"Completado"}),this.close(),!0}return!1}catch(a){return this.mostrarError({mensaje:a,titulo:"Inesperado (guardarSolicitud)"}),!1}finally{this.ocultarLoading()}},async borrarSolicitud(){if(await this.$root.$confirm.open({titulo:"ELIMINAR",msj:["Una vez Eliminada no se podra recuperar.",`La Solicitud realizada el ${this.mostrarFecha(this.dataEdit.fecha,"time")}hs por ${this.areasDB.find((a=>a.id===this.dataEdit.origen))?.area?.replace?.(" ","_")} sera ELIMINADA.\n¿Desea continuar?`]}))try{this.mostrarLoading({titulo:"Borrando Solicitud..."});let a=null;return a=await this.requestAPI({method:"delete",url:`/farmacia/solicitud/${this.dataEdit._id}`}),!!a?.data?.ok&&(this.mostrarMensaje({msj:["Borrado exitosamente."],titulo:"Borrado Exitoso"}),this.close(),!0)}catch(a){return this.mostrarError({mensaje:a,titulo:"Inesperado (borrarSolicitud)"}),!1}finally{this.ocultarLoading()}},async getCantidadStock(){try{if("Pendiente"===this.dataEdit.estado&&this.dataEdit.origen&&this.stockASolicitar.some((a=>!!a))){let a=`area=${this.dataEdit.origen}&insumos=${JSON.stringify(this.stockASolicitar)}`,t=await this.requestAPI({method:"get",url:`/farmacia/stock/solicitud?${a}`});if(t?.data?.ok){for(let a=0;a<this.dataEdit.insumos.length;a++){let e=t.data.stock.find((t=>t.insumo===this.dataEdit.insumos[a].insumo));this.dataEdit.insumos[a].stock=e?.total??0,this.$set(this.dataEdit.insumos,a,this.dataEdit.insumos[a])}return!0}return!1}return!1}catch(a){return this.mostrarError({mensaje:a,titulo:"Inesperado (getCantidadStock)"}),!1}}}},I=T;var A=e(1001),B=(0,A.Z)(I,C,F,!1,null,null,null);const L=B.exports;var $=e(3718);const R={name:"farmaciaSolicitudBuscar",components:{dateSelect:E.Z,bodyDataTableDinamic:k.Z,dialogSolicitud:L,componentFiltroAvanzado:$.Z},data:()=>({areasFiltro:[],dataTable:[],dataTableSelected:"Todas",dataTableSelect:["Todas","Pendientes","Emergencias","Urgencias","Rutinas","Aceptadas","Rechazadas"],filtro:{desde:"",hasta:"",areas:[],insumos:[]},ultimoFiltro:{},search:"",paginacion:{sortBy:"fecha",descending:!0,rowsPerPage:10,page:1},headers:[{text:"Acciones",value:"id",align:"center",sortable:!1,width:"5%",ignore:!0},{text:"Fecha",value:"fecha",align:"left",class:"text-xs-left",width:"15%",ruta:"fecha",date:!0,time:!0},{text:"Origen",value:"origenDB",align:"left",class:"text-capitalize text-xs-left",width:"15%",ruta:"origenDB"},{text:"Dirigida a",value:"destinoDB",align:"left",class:"text-capitalize text-xs-left",width:"20%",ruta:"destinoDB"},{text:"Estado",value:"estado",align:"left",class:"text-xs-left",width:"10%",ruta:"estado"},{text:"Motivo",value:"motivo",align:"left",class:"text-xs-left",width:"10%",ruta:"motivo"}]}),computed:{...(0,_.rn)(["loading","hoy","monthBefore","persona"]),headersDinamics(){return[...this.headers.filter((a=>!0!==a.ignore))]},dataTableFilter(){return this.dataTable?.filter((a=>"Todas"===this.dataTableSelected||("Pendientes"===this.dataTableSelected&&"Pendiente"===a.estado||("Rutinas"===this.dataTableSelected&&"Rutina"===a.motivo||("Urgencias"===this.dataTableSelected&&"Urgencia"===a.motivo||("Emergencias"===this.dataTableSelected&&"Emergencia"===a.motivo||("Aceptadas"===this.dataTableSelected&&"Aceptada"===a.estado||("Rechazadas"===this.dataTableSelected&&"Rechazada"===a.estado||void 0))))))))}},watch:{dataTableFilter(){this.paginacion.page>Math.ceil(this.dataTableFilter?.length/this.paginacion.rowsPerPage)&&(this.paginacion.page=1)}},async created(){this.filtro.desde=this.monthBefore,this.filtro.hasta=this.hoy;let a=[...await this.buscarAreaFiltros({filtro:{farmacia:!0},populate:"no",select:"area"})];this.persona.farmacia.general?.reportes||this.persona.farmacia.general?.admin?(this.areasFiltro=a,this.filtro.areas=a.map((a=>a.id))):(this.areasFiltro=await this.filtrarArrayParaSelectsDisabled({arraySelects:a,arrayEnable:this.persona.farmacia.gestion,propCompare:"_id"}),this.filtro.areas=[...this.persona.farmacia.gestion]),await this.recargarDataTable(this.filtro)},methods:{...(0,_.OI)(["mostrarLoading","mostrarError","ocultarLoading","mostrarDialogIframe"]),...(0,_.nv)(["retroceder","routerResolve","filtrarArrayParaSelectsDisabled","requestAPI"]),...(0,_.nv)("main_areas",["buscarAreaFiltros"]),...(0,_.nv)("farmacia",["actualizarDialogSolicitud","getRequestFilter"]),backgroundClass(a){if(!a)return"";try{if("Aceptada"===a.estado)return"background-color: green lighten-5";if("Rechazada"===a.estado)return"background-color: red lighten-4";if("Rutina"===a.motivo)return"background-color: blue lighten-4";if("Urgencia"===a.motivo)return"background-color: yellow lighten-4";if("Emergencia"===a.motivo)return"background-color: orange lighten-2"}catch(t){return""}},async recargarDataTable(a){if(a){let t=await this.buscarSolicitudesFiltro(a);t&&(this.dataTable=t,this.ultimoFiltro=this._cloneDeep(a))}else this.dataTable=await this.buscarSolicitudesFiltro(this.ultimoFiltro)},async buscarSolicitudesFiltro(a){try{this.mostrarLoading({titulo:"Buscando Solicitudes..."});let t=await this.getRequestFilter({payload:a});if(t.error)return;let e=null;return e=await this.requestAPI({method:"get",url:`/farmacia/solicitudes?${t.dato}`}),e?.data?.ok?e.data.solicitudes:[{origenDB:"error de carga, recargar pagina",id:void 0}]}catch(t){return this.mostrarError({mensaje:t,titulo:"Inesperado (buscarSolicitudesFiltro)"}),[{origenDB:"error de carga(buscarSolicitudesFiltro), recargar pagina",id:void 0}]}finally{this.ocultarLoading()}},async reporte(){if(this.filtro.areas.length>0){localStorage.setItem("pdfTemp",JSON.stringify(this.filtro));let a=await this.routerResolve({name:"FarmaciaSolicitudImprimir",query:{descarga:!1}});this.mostrarDialogIframe({src:a.href,titulo_name:`Farmacia Solicitudes ${this.filtro.desde} ~ ${this.filtro.hasta}`})}else this.mostrarError({errores:"",mensaje:"Complete por lo menos con una Farmacia para el reporte.",titulo:"Valores Requeridos."})}}},z=R;var q=(0,A.Z)(z,y,x,!1,null,null,null);const j=q.exports},6131:(a,t,e)=>{e.r(t),e.d(t,{default:()=>T});var i=e(8469),r=e(7416),o=e(6194),s=e(8956),n=e(2353),l=e(9418),d=e(5050),c=e(7352),u=e(108),m=e(683),g=e(3667),h=e(9456),p=e(6446),f=e(8143),b=e(4618),v=e(1415),y=function(){var a=this,t=a._self._c;return t(d.Z,{attrs:{fluid:"","grid-list-xs":""}},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"","text-xs-center":""}},[t(m.Z,{attrs:{"pa-1":"","ma-1":"",cuarto:"",xs12:""}},[t(s.Z,{staticClass:"white--text",attrs:{color:"cuarto darken-2"}},[t(n.ZB,{staticClass:"px-0 text-uppercase"},[a._v("====== Gestion de Farmacia ======")])],1)],1)],1),t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":""}},[t(m.Z,{attrs:{"pa-1":"","ma-1":"",cuarto:"",xs12:""}},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"",cuarto:"","darken-1":""}},[t(m.Z,{attrs:{"px-3":""}},[t(g.Z,{attrs:{medium:"",color:"white",left:""}},[a._v("medication")]),t("span",{staticClass:"title white--text"},[a._v("Farmacia / Transferencias")])],1),t(f.Cl),t(o.Z,{attrs:{fab:"",small:"",color:"primary darken-2"},on:{click:function(t){return a.retroceder()}}},[t(g.Z,[a._v("far fa-arrow-alt-circle-left")])],1)],1),t(s.Z,{staticClass:"elevation-6",attrs:{color:"grey lighten-2"}},[t(n.ZB,{staticClass:"px-0"},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"","text-xs-center":""}},[t(m.Z,{attrs:{xs12:"","px-3":""}},[t(s.Z,{staticClass:"grey lighten-3"},[t(h.Z,{attrs:{"justify-center":"",row:"",wrap:""},on:{keypress:function(t){return!t.type.indexOf("key")&&a._k(t.keyCode,"enter",13,t.key,"Enter")?null:a.recargarDataTable(a.filtro)}}},[t(m.Z,{attrs:{xs12:"",sm6:"",md3:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{value:a.filtro.desde,"background-color":"cuarto lighten-5",color:"cuarto",label:"Desde",icon:"today",max:a.filtro.hasta,requerido:"true"},model:{value:a.filtro.desde,callback:function(t){a.$set(a.filtro,"desde",t)},expression:"filtro.desde"}})],1),t(m.Z,{attrs:{xs12:"",sm6:"",md3:"","px-3":""}},[t("dateSelect",{staticClass:"capitalizar",attrs:{value:a.filtro.hasta,"background-color":"cuarto lighten-5",color:"cuarto",label:"Hasta",icon:"event",min:a.filtro.desde,requerido:"true"},model:{value:a.filtro.hasta,callback:function(t){a.$set(a.filtro,"hasta",t)},expression:"filtro.hasta"}})],1),t(m.Z,{attrs:{xs12:"",md10:"","px-3":"","mb-3":""}},[t("componentFiltroAvanzado",{attrs:{filtro:a.filtro,areasFiltro:a.areasFiltro,insumos:{select:"nombre descripcion nombreC"},procedencia:!0}})],1)],1),t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":""}},[t(o.Z,{staticClass:"white--text mb-2",attrs:{round:"",color:"cuarto darken-2",disabled:a.loading.estado,loading:a.loading.estado},on:{click:function(t){return a.recargarDataTable(a.filtro)}}},[t(g.Z,{attrs:{medium:"",left:""}},[a._v("search")]),a._v(" Buscar Transferencias")],1),t(u.Z,{staticClass:"hidden-xs-only mx-4 my-1 black",attrs:{vertical:""}}),t(o.Z,{staticClass:"white--text mb-2",attrs:{round:"",color:"cuarto darken-2",disabled:a.loading.estado,loading:a.loading.estado},on:{click:function(t){return a.reporte()}}},[t(g.Z,{attrs:{medium:"",left:""}},[a._v("fa-solid fa-file-pdf")]),a._v(" Transferencias Estado PDF")],1)],1)],1)],1)],1)],1)],1)],1),t(m.Z,{attrs:{"pa-1":"","ma-1":"",xs12:"",cuarto:"","lighten-1":""}},[t(s.Z,{staticClass:"elevation-6"},[t(h.Z,{attrs:{row:"",wrap:"","align-center":"","justify-center":"",primary:""}},[t(m.Z,{attrs:{"px-3":""}},[t(g.Z,{attrs:{medium:"",color:"white",left:""}},[a._v("fa-solid fa-dolly")]),t("span",{staticClass:"title white--text"},[a._v("Transferencias de Insumos")])],1),t(f.Cl)],1),t(l.Z,[t(m.Z,{attrs:{xs12:"",sm4:"","px-2":""}},[t(b.h,{attrs:{"append-icon":"search",label:"Buscar","single-line":"","hide-details":"",clearable:""},model:{value:a.search,callback:function(t){a.search=t},expression:"search"}})],1),t(f.Cl),t(m.Z,{attrs:{xs12:"",sm6:"",md4:"","px-2":""}},[t(r.Z,{staticClass:"capitalizar",attrs:{items:a.dataTableSelect,label:"Mostrar","prepend-icon":"fa-solid fa-dolly",color:"cuarto","background-color":"cuarto lighten-5"},model:{value:a.dataTableSelected,callback:function(t){a.dataTableSelected=t},expression:"dataTableSelected"}})],1),t(u.Z,{staticClass:"hidden-xs-only mx-2 primary",attrs:{inset:"",vertical:""}}),t(o.Z,{staticClass:"mb-2",attrs:{round:"",color:"primary",disabled:a.loading.estado||!(a.persona.farmacia.gestion?.length>0||a.persona.farmacia.general?.admin),loading:a.loading.estado},on:{click:function(t){return a.actualizarDialogIngresoTransferencia({state:!0,type:{transferencia:!0}})}}},[t(g.Z,{attrs:{medium:"",left:""}},[a._v("input")]),a._v(" Nueva Transferencia")],1)],1),t(c.Z,{staticClass:"elevation-6",staticStyle:{"table-layout":"fixed"},attrs:{id:"tablita",headers:a.headers,items:a.dataTableFilter,"item-key":"_id",pagination:a.paginacion,"rows-per-page-items":[5,10,25,50],loading:a.loading.estado,search:a.search},on:{"update:pagination":function(t){a.paginacion=t}},scopedSlots:a._u([{key:"no-results",fn:function(){return[t(i.Z,{staticClass:"text-sm-left",attrs:{value:!0,color:"error",icon:"warning"}},[a._v(' No se encontraron resultados para "'+a._s(a.search)+'". ')])]},proxy:!0},{key:"no-data",fn:function(){return[t(i.Z,{staticClass:"text-sm-left",attrs:{value:!0,color:"error",icon:"warning"}},[a._v(" No hay datos para mostrar. ")])]},proxy:!0},{key:"items",fn:function(e){return[t("tr",{class:a.backgroundClass(e.item)},[t("td",{staticClass:"text-sm-left"},[t("div",{staticClass:"text-xs-center",staticStyle:{width:"90px"}},[t(v.Z,{attrs:{top:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:i}){return[t(o.Z,a._g({attrs:{disabled:a.noAdminNoGestion||a.loading.estado||e.item.recibido||e.item.remito&&!e.item.retirado||a.noAdminSiGestion&&!a.persona.farmacia.gestion.includes(e.item.destino),color:"white",small:"",icon:""},on:{click:function(t){return a.recibirIngreso({ingreso:{id:e.item._id,orden_compra:e.item.orden_compra,remito:e.item.remito},finish:a.recargarDataTable,confirm:a.$root.$confirm})}}},i),[t(g.Z,{attrs:{color:e.item.recibido?"green":"red"}},[a._v(a._s(e.item.recibido?"task_alt":"radio_button_unchecked"))])],1)]}}],null,!0)},[t("span",[a._v("Recibir")])]),t(v.Z,{attrs:{right:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:i}){return[t(o.Z,a._g({attrs:{disabled:a.noAdminNoGestion||a.loading.estado||e.item.retirado||a.noAdminSiGestion&&!a.persona.farmacia.gestion.includes(e.item.origen),color:"white",small:"",icon:""},on:{click:function(t){return a.retirarTransferencia({remito:e.item.remito,finish:a.recargarDataTable})}}},i),[t(g.Z,{attrs:{color:e.item.retirado?"green":"error"}},[a._v(a._s(e.item.retirado?"output":"check_box_outline_blank"))])],1)]}}],null,!0)},[t("span",[a._v("Retirar de Stock")])]),t(v.Z,{attrs:{bottom:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:i}){return[t(o.Z,a._g({attrs:{disabled:a.loading.estado,color:"white",small:"",icon:""},on:{click:function(t){return a.imprimirRemito({remito:e.item})}}},i),[t(g.Z,{attrs:{color:"green"}},[a._v("print")])],1)]}}],null,!0)},[t("span",[a._v("Ver PDF")])]),t(v.Z,{attrs:{right:"","close-delay":"0"},scopedSlots:a._u([{key:"activator",fn:function({on:i}){return[t(o.Z,a._g({attrs:{disabled:a.loading.estado,color:"white",small:"",icon:""},on:{click:function(t){return a.actualizarDialogIngresoTransferencia({state:!0,type:{transferencia:!0},ingreso:{remito:e.item}})}}},i),[t(g.Z,{attrs:{color:"blue"}},[a._v("visibility")])],1)]}}],null,!0)},[t("span",[a._v("Ver Transferencia")])])],1)]),a._l(a.headersDinamics,(function(a){return t("td",{key:a.text,class:a.class},[t("bodyDataTableDinamic",{attrs:{props:e,field:a}})],1)}))],2)]}}])},[t(p.Z,{attrs:{color:"blue",indeterminate:""}})],1)],1)],1),t(m.Z,{attrs:{"pa-1":"","ma-1":"",red:"","darken-2":"",xs12:""}},[t(s.Z,[t(n.ZB,{staticClass:"px-3 font-weight-medium"},[t("p",[t(g.Z,{attrs:{color:"yellow darken-3",left:""}},[a._v(" warning ")]),t("b",[t("u",[a._v("Referencia de Colores:")])])],1),t("ul",[t("li",{staticClass:"green--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Verde:")])]),a._v(" Transicion "),t("b",[t("u",[a._v("Finalizada")])]),a._v(" (Recibida). ")]),t("li",{staticClass:"orange--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Anaranjado:")])]),a._v(" Transicion incompleta falta que la "),t("b",[t("u",[a._v("Recibamos")])]),a._v(" en Destino. ")]),t("li",{staticClass:"text-yellow-shadow",attrs:{type:"square"}},[t("b",[t("u",[a._v("Amarillo:")])]),a._v(" Transicion incompleta falta que la "),t("b",[t("u",[a._v("Retiremos")])]),a._v(" del Origen. ")]),t("li",{staticClass:"grey--text",attrs:{type:"square"}},[t("b",[t("u",[a._v("Gris:")])]),t("ul",[t("li",[a._v(" Transicion incompleta falta que la "),t("b",[t("u",[a._v("Reciban")])]),a._v(" en Destino. ")]),t("li",[a._v(" Transicion incompleta falta que la "),t("b",[t("u",[a._v("Retiren")])]),a._v(" del Origen. ")])])])])])],1)],1)],1),t("dialogTransferencia",{attrs:{closeFinish:a.recargarDataTable}})],1)},x=[],_=e(629),E=e(3979),k=e(5716),Z=e(3849),w=e(3718);const D={name:"farmaciaTransferenciaBuscar",components:{dateSelect:E.Z,bodyDataTableDinamic:k.Z,dialogTransferencia:Z.Z,componentFiltroAvanzado:w.Z},data:()=>({areasFiltro:[],noAdminNoGestion:!1,noAdminSiGestion:!1,dataTable:[],dataTableSelected:"Todos",dataTableSelect:["Todos","Aptos para que Retiremos","Aptos para que Recibamos","Transiciones Incompletas","Transiciones Finalizadas"],filtro:{desde:"",hasta:"",areas:[],insumos:[],procedencias:[]},ultimoFiltro:{},search:"",paginacion:{sortBy:"remito",descending:!0,rowsPerPage:10,page:1},headers:[{text:"Acciones",value:"id",align:"center",sortable:!1,width:"5%",ignore:!0},{text:"Fecha",value:"fecha",align:"left",class:"text-xs-left",width:"15%",ruta:"fecha",date:!0,time:!0},{text:"Transf. Origen",value:"origenDB",align:"left",class:"text-capitalize text-xs-left",width:"20%",ruta:"origenDB"},{text:"Destino",value:"destinoDB",align:"left",class:"text-capitalize text-xs-left",width:"20%",ruta:"destinoDB"},{text:"Remito Transf.",value:"remito",align:"left",class:"text-xs-right",width:"20%",ruta:"remito"},{text:"Fec. Planificada",value:"fec_planificada",align:"left",class:"text-xs-left",width:"10%",ruta:"fec_planificada",date:!0},{text:"Retirado Origen",value:"retirado",align:"left",class:"text-xs-left",width:"10%",ruta:"retirado",date:!0,time:!0},{text:"Recibido Destino",value:"recibido",align:"left",class:"text-xs-left",width:"10%",ruta:"recibido",date:!0,time:!0}]}),computed:{...(0,_.rn)(["loading","hoy","monthBefore","persona"]),headersDinamics(){return[...this.headers.filter((a=>!0!==a.ignore))]},dataTableFilter(){return this.dataTable?.filter((a=>"Todos"===this.dataTableSelected||(!("Transiciones Finalizadas"!==this.dataTableSelected||!a.recibido)||(!("Transiciones Incompletas"!==this.dataTableSelected||a.retirado&&a.recibido)||(!("Aptos para que Retiremos"!==this.dataTableSelected||a.retirado||!(this.persona.farmacia.general?.admin||this.noAdminSiGestion&&this.persona.farmacia.gestion.includes(a.origen)))||(!("Aptos para que Recibamos"!==this.dataTableSelected||!a.retirado||a.recibido||!(this.persona.farmacia.general?.admin||this.noAdminSiGestion&&this.persona.farmacia.gestion.includes(a.destino)))||void 0))))))}},watch:{dataTableFilter(){this.paginacion.page>Math.ceil(this.dataTableFilter?.length/this.paginacion.rowsPerPage)&&(this.paginacion.page=1)}},async created(){this.filtro.desde=this.monthBefore,this.filtro.hasta=this.hoy,this.persona.farmacia.general?.admin||(this.persona.farmacia.gestion?this.noAdminSiGestion=!0:this.noAdminNoGestion=!0);let a=[...await this.buscarAreaFiltros({filtro:{farmacia:!0},populate:"no",select:"area"})];this.persona.farmacia.general?.reportes||this.persona.farmacia.general?.admin?(this.areasFiltro=a,this.filtro.areas=a.map((a=>a.id))):(this.areasFiltro=await this.filtrarArrayParaSelectsDisabled({arraySelects:a,arrayEnable:this.persona.farmacia.gestion,propCompare:"_id"}),this.filtro.areas=[...this.persona.farmacia.gestion]),await this.recargarDataTable(this.filtro)},methods:{...(0,_.OI)(["mostrarLoading","ocultarLoading","mostrarError","mostrarMensaje","mostrarDialogIframe"]),...(0,_.nv)(["retroceder","filtrarArrayParaSelectsDisabled","requestAPI","routerResolve"]),...(0,_.nv)("main_areas",["buscarAreaFiltros"]),...(0,_.nv)("farmacia",["actualizarDialogIngresoTransferencia","getRequestFilter","recibirIngreso"]),backgroundClass(a){if(!a)return"";try{return a.recibido?"background-color: green lighten-5":this.noAdminNoGestion&&!this.persona.farmacia.general?.admin?"background-color: grey lighten-4":!a.retirado&&(this.persona.farmacia.general?.admin||this.noAdminSiGestion&&this.persona.farmacia.gestion.includes(a.origen))?"background-color: yellow lighten-4":this.persona.farmacia.general?.admin||this.noAdminSiGestion&&this.persona.farmacia.gestion.includes(a.destino)?"background-color: orange lighten-4":"background-color: grey lighten-4"}catch(t){return""}},async recargarDataTable(a){if(a){let t=await this.buscarTransferenciasFiltro(a);t&&(this.dataTable=t,this.ultimoFiltro=this._cloneDeep(a))}else this.dataTable=await this.buscarTransferenciasFiltro(this.ultimoFiltro)},async buscarTransferenciasFiltro(a){try{this.mostrarLoading({titulo:"Buscando Transferencias..."});let t=await this.getRequestFilter({payload:a});if(t.error)return;let e=null;return e=await this.requestAPI({method:"get",url:`/farmacia/transferencias?${t.dato}`}),e?.data?.ok?e?.data?.transferencias:[{remito:"error de carga(buscarTransferenciasFiltro), recargar pagina",id:void 0}]}catch(t){return this.mostrarError({mensaje:t,titulo:"Inesperado"}),[{remito:"error de carga(buscarTransferenciasFiltro.catch), recargar pagina",id:void 0}]}finally{this.ocultarLoading()}},async retirarTransferencia(a){if(await this.$root.$confirm.open({titulo:"RETIRAR",msj:["Verifique que todos los insumos esten cargados correctamente,\nuna vez Retirado no se podra modificar.","Se retiraran del Stock las Cantidades de los insumos correspondientes.",`La Transferencia: ${a.remito}, sera marcada como RETIRADA.\n¿Desea continuar?`]}))try{this.mostrarLoading({titulo:"Retirando Stock..."});let t=null;return t=await this.requestAPI({method:"put",url:"/farmacia/retirar",update:a}),!!t?.data?.ok&&(this.mostrarMensaje({msj:["Retirado exitosamente."],titulo:"Completado"}),a.finish&&a.finish(),t.data.retirado)}catch(t){return this.mostrarError({mensaje:t,titulo:"Inesperado"}),!1}finally{this.ocultarLoading()}},async reporte(){if(this.filtro.areas.length>0){localStorage.setItem("pdfTemp",JSON.stringify(this.filtro));let a=await this.routerResolve({name:"FarmaciaTransferenciaEstado",query:{descarga:!1}});this.mostrarDialogIframe({src:a.href,titulo_name:`Farmacia Transferencias ${this.filtro.desde} ~ ${this.filtro.hasta}`})}else this.mostrarError({mensaje:"Complete por lo menos con una Farmacia para el reporte.",titulo:"Valores Requeridos."})},async imprimirRemito(a){try{localStorage.setItem("pdfTemp",JSON.stringify(a.remito));let t=await this.routerResolve({name:"FarmaciaRemitoImprimir",query:{descarga:!1}});this.mostrarDialogIframe({src:t.href,titulo_name:`Remito ${a.remito.remito}`})}catch(t){this.mostrarError({mensaje:t,titulo:"Inesperado"})}}}},S=D;var C=e(1001),F=(0,C.Z)(S,y,x,!1,null,null,null);const T=F.exports},445:(a,t,e)=>{e.d(t,{Z:()=>r});var i=e(21);const r={name:"v-form",mixins:[(0,i.J)("form")],inheritAttrs:!1,props:{value:Boolean,lazyValidation:Boolean},data:function(){return{inputs:[],watchers:[],errorBag:{}}},watch:{errorBag:{handler:function(){var a=Object.values(this.errorBag).includes(!0);this.$emit("input",!a)},deep:!0,immediate:!0}},methods:{watchInput:function(a){var t=this,e=function(a){return a.$watch("hasError",(function(e){t.$set(t.errorBag,a._uid,e)}),{immediate:!0})},i={_uid:a._uid,valid:void 0,shouldValidate:void 0};return this.lazyValidation?i.shouldValidate=a.$watch("shouldValidate",(function(r){r&&(t.errorBag.hasOwnProperty(a._uid)||(i.valid=e(a)))})):i.valid=e(a),i},validate:function(){var a=this.inputs.filter((function(a){return!a.validate(!0)})).length;return!a},reset:function(){for(var a=this,t=this.inputs.length;t--;)this.inputs[t].reset();this.lazyValidation&&setTimeout((function(){a.errorBag={}}),0)},resetValidation:function(){for(var a=this,t=this.inputs.length;t--;)this.inputs[t].resetValidation();this.lazyValidation&&setTimeout((function(){a.errorBag={}}),0)},register:function(a){var t=this.watchInput(a);this.inputs.push(a),this.watchers.push(t)},unregister:function(a){var t=this.inputs.find((function(t){return t._uid===a._uid}));if(t){var e=this.watchers.find((function(a){return a._uid===t._uid}));e.valid&&e.valid(),e.shouldValidate&&e.shouldValidate(),this.watchers=this.watchers.filter((function(a){return a._uid!==t._uid})),this.inputs=this.inputs.filter((function(a){return a._uid!==t._uid})),this.$delete(this.errorBag,t._uid)}}},render:function(a){var t=this;return a("form",{staticClass:"v-form",attrs:Object.assign({novalidate:!0},this.$attrs),on:{submit:function(a){return t.$emit("submit",a)}}},this.$slots.default)}}}}]);